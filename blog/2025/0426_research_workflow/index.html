<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kazuharu Yanagimoto">
<meta name="dcterms.date" content="2025-04-26">

<title>Research Workflow with Quarto + {targets} – Kazuharu Yanagimoto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../static/img/favicon.drawio.svg" rel="icon" type="image/svg+xml">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-c5b4919bf80523fba3e26ef73c70676e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1e57dc25c9d218e2c8f9dcb458291ba0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../site_libs/quarto-contrib/iconify-1.0.0-beta.2/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EX523L4LWJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EX523L4LWJ', { 'anonymize_ip': true});
</script>
<script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<meta property="og:title" content="Research Workflow with Quarto + {targets} – Kazuharu Yanagimoto">
<meta property="og:description" content="">
<meta property="og:image" content="https://kazuyanagimoto.com/blog/2025/0426_research_workflow/img/thumbnail.png">
<meta property="og:site_name" content="Kazuharu Yanagimoto">
<meta property="og:image:height" content="1617">
<meta property="og:image:width" content="2591">
<meta name="twitter:title" content="Research Workflow with Quarto + {targets} – Kazuharu Yanagimoto">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://kazuyanagimoto.com/blog/2025/0426_research_workflow/img/thumbnail.png">
<meta name="twitter:creator" content="@kazuyanagimoto">
<meta name="twitter:site" content="@kazuyanagimoto">
<meta name="twitter:image-height" content="1617">
<meta name="twitter:image-width" content="2591">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Kazuharu Yanagimoto</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../software/index.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://kazuyanagimoto.com/cv/cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Research Workflow with Quarto + {targets}</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">Quarto</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Julia</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kazuharu Yanagimoto </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 26, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#let-targets-take-the-lead" id="toc-let-targets-take-the-lead" class="nav-link active" data-scroll-target="#let-targets-take-the-lead">Let {targets} Take the Lead</a>
  <ul class="collapse">
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow">Workflow</a></li>
  <li><a href="#targets-basics" id="toc-targets-basics" class="nav-link" data-scroll-target="#targets-basics">{targets} Basics</a>
  <ul class="collapse">
  <li><a href="#the-three-basic-elements" id="toc-the-three-basic-elements" class="nav-link" data-scroll-target="#the-three-basic-elements">The Three Basic Elements</a></li>
  <li><a href="#execution-and-dependency-management" id="toc-execution-and-dependency-management" class="nav-link" data-scroll-target="#execution-and-dependency-management">Execution and Dependency Management</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#quarto-targets-workflow" id="toc-quarto-targets-workflow" class="nav-link" data-scroll-target="#quarto-targets-workflow">Quarto + {targets} Workflow</a>
  <ul class="collapse">
  <li><a href="#initial-configuration-in-_targets.r" id="toc-initial-configuration-in-_targets.r" class="nav-link" data-scroll-target="#initial-configuration-in-_targets.r">1. Initial Configuration in <code>_targets.R</code></a>
  <ul class="collapse">
  <li><a href="#tar_source" id="toc-tar_source" class="nav-link" data-scroll-target="#tar_source"><code>tar_source()</code></a></li>
  <li><a href="#tar_plan" id="toc-tar_plan" class="nav-link" data-scroll-target="#tar_plan"><code>tar_plan()</code></a></li>
  <li><a href="#here_rel" id="toc-here_rel" class="nav-link" data-scroll-target="#here_rel"><code>here_rel()</code></a></li>
  </ul></li>
  <li><a href="#define-data-cleaning" id="toc-define-data-cleaning" class="nav-link" data-scroll-target="#define-data-cleaning">2. Define Data Cleaning</a></li>
  <li><a href="#configure-the-website" id="toc-configure-the-website" class="nav-link" data-scroll-target="#configure-the-website">3. Configure the Website</a></li>
  <li><a href="#experiment-with-data-analysis-and-models" id="toc-experiment-with-data-analysis-and-models" class="nav-link" data-scroll-target="#experiment-with-data-analysis-and-models">4. Experiment with Data Analysis and Models</a></li>
  <li><a href="#summarize-interim-results-in-slides" id="toc-summarize-interim-results-in-slides" class="nav-link" data-scroll-target="#summarize-interim-results-in-slides">5. Summarize Interim Results in Slides</a></li>
  <li><a href="#repeat-steps-3-5-and-incorporate-key-results-into-the-pipeline" id="toc-repeat-steps-3-5-and-incorporate-key-results-into-the-pipeline" class="nav-link" data-scroll-target="#repeat-steps-3-5-and-incorporate-key-results-into-the-pipeline">6. Repeat Steps 3-5 and Incorporate Key Results into the Pipeline</a>
  <ul class="collapse">
  <li><a href="#incorporate-key-results-into-the-pipeline" id="toc-incorporate-key-results-into-the-pipeline" class="nav-link" data-scroll-target="#incorporate-key-results-into-the-pipeline">Incorporate Key Results into the Pipeline</a></li>
  <li><a href="#incorporate-julia-code-into-the-pipeline" id="toc-incorporate-julia-code-into-the-pipeline" class="nav-link" data-scroll-target="#incorporate-julia-code-into-the-pipeline">Incorporate Julia Code into the Pipeline</a></li>
  </ul></li>
  <li><a href="#write-the-manuscript-with-final-results" id="toc-write-the-manuscript-with-final-results" class="nav-link" data-scroll-target="#write-the-manuscript-with-final-results">7. Write the Manuscript with Final Results</a>
  <ul class="collapse">
  <li><a href="#why-write-as-a-quarto-book" id="toc-why-write-as-a-quarto-book" class="nav-link" data-scroll-target="#why-write-as-a-quarto-book">Why Write as a Quarto Book?</a></li>
  <li><a href="#for-latex-users" id="toc-for-latex-users" class="nav-link" data-scroll-target="#for-latex-users">For LaTeX Users</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="let-targets-take-the-lead" class="level1">
<h1>Let {targets} Take the Lead</h1>
<p><a href="https://books.ropensci.org/targets/"><code>{targets}</code></a> is an R package for building research workflows. Its primary feature is managing R objects (data, functions, and results) and their dependencies, automatically recalculating downstream objects when upstream objects change. This allows you to maintain reproducibility throughout your research process.</p>
<p>When combined with <a href="https://quarto.org/">Quarto</a>, you can manage all aspects of your research workflow in a single pipeline—from interim reports and slides to writing the final manuscript. This article explains a Quarto + {targets} research workflow I actively use in my own research. While the final pipeline is a clean and simple workflow, I also add flexibility for experimentation and iteration.</p>
<p>The code is available <a href="https://github.com/kazuyanagimoto/quarto-research-blog/">here</a>. Please refer to it for code examples and directory structure.</p>
<section id="workflow" class="level2">
<h2 class="anchored" data-anchor-id="workflow">Workflow</h2>
<ol type="1">
<li>Set up initial configuration in <code>_targets.R</code></li>
<li>Define data cleaning in <code>R/tar_data.R</code></li>
<li>Configure the website in <code>_quarto.yml</code></li>
<li>Experiment with data analysis and models in <code>playground/yymmdd_*/index.qmd</code></li>
<li>Summarize interim results in slides <code>slide/yymmdd_*/index.qmd</code></li>
<li>Repeat steps 3-5. Incorporate key results into the pipeline via <code>R/tar_fact.R</code>, <code>R/tar_model.R</code></li>
<li>Write the manuscript with final results in <code>manuscript/*.qmd</code></li>
</ol>
<p>By the time you finish writing your manuscript, you should have a pipeline like the one below. This was generated using <code>targets::tar_mermaid()</code>.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
  style Graph fill:#FFFFFF00,stroke:#000000;
  subgraph Graph
    direction LR
    xa60862c4ab4296bb(["raw_accident_bike"]):::skipped --&gt; x034caa8952fea0bc(["accident_bike"]):::skipped
    x6d55c198484f4a32(["demand_supply_file"]):::skipped --&gt; xce43a680ab7f20d8(["demand_supply"]):::skipped
    x6b88c7f0a7cfeae2(["res_model"]):::skipped --&gt; x6d55c198484f4a32(["demand_supply_file"]):::skipped
    xae87dc67ba338d4f(["equilibrium_file"]):::skipped --&gt; xa24c4be63b494044(["equilibrium"]):::skipped
    x6b88c7f0a7cfeae2(["res_model"]):::skipped --&gt; xae87dc67ba338d4f(["equilibrium_file"]):::skipped
    x02d319b13cb530b9(["jl_file_main"]):::skipped --&gt; xad77b747e8ecd697(["jl_main"]):::skipped
    x693460ba53a4c0cd(["jl_file_model"]):::skipped --&gt; x25bf76549192ec22(["jl_model"]):::skipped
    x034caa8952fea0bc(["accident_bike"]):::skipped --&gt; x9470f51581cb7d73(["logit_hospital_death"]):::skipped
    xce43a680ab7f20d8(["demand_supply"]):::skipped --&gt; x24abe6175c545e8a(["manuscript"]):::skipped
    xb033ae8b49095a26(["num_accident"]):::skipped --&gt; x24abe6175c545e8a(["manuscript"]):::skipped
    xa24c4be63b494044(["equilibrium"]):::skipped --&gt; x24abe6175c545e8a(["manuscript"]):::skipped
    x9470f51581cb7d73(["logit_hospital_death"]):::skipped --&gt; x24abe6175c545e8a(["manuscript"]):::skipped
    x5b3deba9281c9212(["fns_graphics"]):::skipped --&gt; x24abe6175c545e8a(["manuscript"]):::skipped
    x41180a2d7b7b3c28(["parameters"]):::skipped --&gt; x24abe6175c545e8a(["manuscript"]):::skipped
    xb033ae8b49095a26(["num_accident"]):::skipped --&gt; xb7f5b6c7e9273aa9(["manuscript_book"]):::skipped
    xce43a680ab7f20d8(["demand_supply"]):::skipped --&gt; xb7f5b6c7e9273aa9(["manuscript_book"]):::skipped
    xa24c4be63b494044(["equilibrium"]):::skipped --&gt; xb7f5b6c7e9273aa9(["manuscript_book"]):::skipped
    x9470f51581cb7d73(["logit_hospital_death"]):::skipped --&gt; xb7f5b6c7e9273aa9(["manuscript_book"]):::skipped
    x5b3deba9281c9212(["fns_graphics"]):::skipped --&gt; xb7f5b6c7e9273aa9(["manuscript_book"]):::skipped
    x41180a2d7b7b3c28(["parameters"]):::skipped --&gt; xb7f5b6c7e9273aa9(["manuscript_book"]):::skipped
    x034caa8952fea0bc(["accident_bike"]):::skipped --&gt; xb033ae8b49095a26(["num_accident"]):::skipped
    xfeeaf8513320133e(["parameters_file"]):::skipped --&gt; x41180a2d7b7b3c28(["parameters"]):::skipped
    x6b88c7f0a7cfeae2(["res_model"]):::skipped --&gt; xfeeaf8513320133e(["parameters_file"]):::skipped
    xee0a5a7de02f740f(["dir_raw_accident_bike"]):::skipped --&gt; xa60862c4ab4296bb(["raw_accident_bike"]):::skipped
    x02d319b13cb530b9(["jl_file_main"]):::skipped --&gt; x6b88c7f0a7cfeae2(["res_model"]):::skipped
    xad77b747e8ecd697(["jl_main"]):::skipped --&gt; x6b88c7f0a7cfeae2(["res_model"]):::skipped
    x25bf76549192ec22(["jl_model"]):::skipped --&gt; x6b88c7f0a7cfeae2(["res_model"]):::skipped
    x034caa8952fea0bc(["accident_bike"]):::skipped --&gt; x5a3744590d99f661(["website"]):::skipped
    x5b3deba9281c9212(["fns_graphics"]):::skipped --&gt; x5a3744590d99f661(["website"]):::skipped
  end
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Before explaining each part of the workflow, let’s cover the basics of <code>{targets}</code>.</p>
</section>
<section id="targets-basics" class="level2">
<h2 class="anchored" data-anchor-id="targets-basics">{targets} Basics</h2>
<p>The official <a href="https://books.ropensci.org/targets/">tutorial</a> is the best way to learn <code>{targets}</code> basics, but in practice, we often use the extended syntax from <code>{tarchetypes}</code>. Here, I’ll explain a minimal usage based on <code>{tarchetypes}</code> syntax. This <a href="https://carpentries-incubator.github.io/targets-workshop/index.html">tutorial</a> was helpful for transitioning from <code>{targets}</code> to <code>{tarchetypes}</code>.</p>
<section id="the-three-basic-elements" class="level3">
<h3 class="anchored" data-anchor-id="the-three-basic-elements">The Three Basic Elements</h3>
<p>The philosophy of <code>{targets}</code> divides research workflows into three elements: <em>files</em>, <em>functions</em>, and <em>objects</em>.</p>
<ul>
<li><em>Files</em>: Objects defined with <code>tar_file()</code> that hold file paths. They also store file size and timestamp, so even if the path hasn’t changed, if the content changes, dependent parts of the pipeline will be recalculated.</li>
<li><em>Objects</em>: Variables, data frames, and other R objects.</li>
<li><em>Functions</em>: R functions. All inputs that the function depends on must be specified, and the output must be a file or object. This makes dependencies explicit.</li>
</ul>
<p>Conceptually, you start with files, read them to create objects, and then use those objects to run functions that create new objects. These elements are defined within <code>tar_plan()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>clean_data1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data1_raw) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  data1_raw <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(col1))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file</span>(data1_raw_file, <span class="st">"path/to/file/data1.csv"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data1_raw =</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(data1_raw_file),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data1_cleaned =</span> <span class="fu">clean_data1</span>(data1_raw),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In the example above, <code>data1_raw_file</code> is a file, <code>data1_raw</code> and <code>data1_cleaned</code> are objects, and <code>readr::read_csv</code> and <code>clean_data1()</code> are functions.</p>
</section>
<section id="execution-and-dependency-management" class="level3">
<h3 class="anchored" data-anchor-id="execution-and-dependency-management">Execution and Dependency Management</h3>
<p>You can visualize your defined pipeline with <code>targets::tar_visnetwork()</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/step0.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Here, triangles represent functions, and circles represent files and objects. The light blue color indicates parts of the pipeline that haven’t been executed yet. When you run <code>targets::tar_make()</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/step1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Successfully executed parts turn gray. If you change the contents of <code>data1.csv</code> (<code>data1_raw_file</code>):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/step2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Parts with dependencies return to the unexecuted state. Of course, running <code>targets::tar_make()</code> again will recalculate the dependent parts:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/step1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Similarly, if you change the contents of the <code>clean_data1()</code> function:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/step2-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>This is the basic workflow of <code>{targets}</code>: define pipelines in <code>tar_plan()</code>, then execute them with <code>tar_make()</code>.</p>
</section>
</section>
</section>
<section id="quarto-targets-workflow" class="level1">
<h1>Quarto + {targets} Workflow</h1>
<section id="initial-configuration-in-_targets.r" class="level2">
<h2 class="anchored" data-anchor-id="initial-configuration-in-_targets.r">1. Initial Configuration in <code>_targets.R</code></h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>_targets.R</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-filename="_targets.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidyverse.quiet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">readr.show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># here::here() returns an absolute path, which then gets stored in tar_meta and</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># becomes computer-specific (i.e. /Users/andrew/Research/blah/thing.Rmd).</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># There's no way to get a relative path directly out of here::here(), but</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># fs::path_rel() works fine with it (see</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/r-lib/here/issues/36#issuecomment-530894167)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>here_rel <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">path_rel</span>(here<span class="sc">::</span><span class="fu">here</span>(...))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_source</span>()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Main Pipeline</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data Preparation ----------</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Analysis ------------------</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  fact,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  model,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Graphics ------------------</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">fns_graphics =</span> <span class="fu">lst</span>(theme_proj, color_base, color_accent, scale_fill_gender),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Manuscript ----------------</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(manuscript_book, <span class="at">path =</span> <span class="st">"manuscript"</span>, <span class="at">quiet =</span> <span class="cn">FALSE</span>),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(manuscript, <span class="at">path =</span> <span class="st">"manuscript/main.qmd"</span>, <span class="at">quiet =</span> <span class="cn">FALSE</span>),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Website -------------------</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    website,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">"."</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">extra_files =</span> <span class="fu">here_rel</span>(<span class="st">"manuscript"</span>, <span class="st">"main.pdf"</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The three crucial parts are:</p>
<section id="tar_source" class="level3">
<h3 class="anchored" data-anchor-id="tar_source"><code>tar_source()</code></h3>
<p>Specifies the directory containing source code for functions used in your pipeline. By default, the <code>R/</code> directory is specified.</p>
</section>
<section id="tar_plan" class="level3">
<h3 class="anchored" data-anchor-id="tar_plan"><code>tar_plan()</code></h3>
<p>Defines the pipeline. You don’t need to include every pipeline element here—you can define pipelines in files loaded via <code>tar_source()</code> and call them. For example, the <code>data</code> pipeline is defined in <code>R/tar_data.R</code>:</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>R/tar_data.R</summary>
<div class="code-with-filename-file">
<pre><strong>R/tar_data.R</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_raw_accident_bike =</span> <span class="fu">download_accident_bike</span>(<span class="fu">here_rel</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"accident_bike"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">raw_accident_bike =</span> <span class="fu">load_accident_bike</span>(dir_raw_accident_bike),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">accident_bike =</span> <span class="fu">clean_accident_bike</span>(raw_accident_bike)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>download_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_file) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  url_base <span class="ot">&lt;-</span> <span class="st">"https://datos.madrid.es/egob/catalogo/300228-%s-accidentes-trafico-detalle.csv"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  keys <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>) <span class="co">#URL becomes caos since 2020</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_file)) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_file)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">pwalk</span>(\(year, key) {</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(url_base, key)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="fu">file.path</span>(dir_file, <span class="fu">paste0</span>(year, <span class="st">".txt"</span>)))</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dir_file)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>load_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_raw_accident_bike) {</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(dir_raw_accident_bike, <span class="fu">paste0</span>(.x, <span class="st">".txt"</span>)),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">delim =</span> <span class="st">";"</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>clean_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_accident_bike) {</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  raw_accident_bike <span class="sc">|&gt;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> num_expediente,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> fecha,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">hms =</span> hora,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">street =</span> localizacion,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">num_street =</span> numero,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_district =</span> cod_distrito,</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> distrito,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_accident =</span> tipo_accidente,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> estado_meteorológico,</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_vehicle =</span> tipo_vehiculo,</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> tipo_persona,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> rango_edad,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> sexo,</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_injury8 =</span> cod_lesividad,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> lesividad,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_x =</span> coordenada_x_utm,</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_y =</span> coordenada_y_utm,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positiva_alcohol,</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positiva_droga</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> lubridate<span class="sc">::</span><span class="fu">dmy_hms</span>(<span class="fu">paste0</span>(date, hms), <span class="at">tz =</span> <span class="st">"Europe/Madrid"</span>),</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> <span class="fu">na_if</span>(district, <span class="st">"NULL"</span>),</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(district),</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        weather,</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Despejado"</span> <span class="ot">=</span> <span class="st">"sunny"</span>,</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nublado"</span> <span class="ot">=</span> <span class="st">"cloud"</span>,</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia débil"</span> <span class="ot">=</span> <span class="st">"soft rain"</span>,</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LLuvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nevando"</span> <span class="ot">=</span> <span class="st">"snow"</span>,</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Granizando"</span> <span class="ot">=</span> <span class="st">"hail"</span>,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        type_person,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Conductor"</span> <span class="ot">=</span> <span class="st">"Driver"</span>,</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pasajero"</span> <span class="ot">=</span> <span class="st">"Passenger"</span>,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Peatón"</span> <span class="ot">=</span> <span class="st">"Pedestrian"</span>,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>        age_c,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Menor de 5 años"</span> <span class="ot">=</span> <span class="st">"&lt;5"</span>,</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 6 a 9 años"</span> <span class="ot">=</span> <span class="st">"6-9"</span>,</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 10 a 14 años"</span> <span class="ot">=</span> <span class="st">"10-14"</span>,</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 15 a 17 años"</span> <span class="ot">=</span> <span class="st">"15-17"</span>,</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 18 a 20 años"</span> <span class="ot">=</span> <span class="st">"18-20"</span>,</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 21 a 24 años"</span> <span class="ot">=</span> <span class="st">"21-24"</span>,</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 25 a 29 años"</span> <span class="ot">=</span> <span class="st">"25-29"</span>,</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 30 a 34 años"</span> <span class="ot">=</span> <span class="st">"30-34"</span>,</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 35 a 39 años"</span> <span class="ot">=</span> <span class="st">"35-39"</span>,</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 40 a 44 años"</span> <span class="ot">=</span> <span class="st">"40-44"</span>,</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 45 a 49 años"</span> <span class="ot">=</span> <span class="st">"45-49"</span>,</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 50 a 54 años"</span> <span class="ot">=</span> <span class="st">"50-54"</span>,</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 55 a 59 años"</span> <span class="ot">=</span> <span class="st">"55-59"</span>,</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 60 a 64 años"</span> <span class="ot">=</span> <span class="st">"60-64"</span>,</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 65 a 69 años"</span> <span class="ot">=</span> <span class="st">"65-69"</span>,</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 70 a 74 años"</span> <span class="ot">=</span> <span class="st">"70-74"</span>,</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Más de 74 años"</span> <span class="ot">=</span> <span class="st">"&gt;74"</span>,</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>        gender,</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Hombre"</span> <span class="ot">=</span> <span class="st">"Men"</span>,</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Mujer"</span> <span class="ot">=</span> <span class="st">"Women"</span>,</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>        injury8,</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sin asistencia sanitaria"</span> <span class="ot">=</span> <span class="st">"No health care"</span>,</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria sólo en el lugar del accidente"</span> <span class="ot">=</span> <span class="st">"Healthcare only at the place of the accident"</span>,</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria ambulatoria con posterioridad"</span> <span class="ot">=</span> <span class="st">"Subsequent outpatient health care"</span>,</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria inmediata en centro de salud o mutua"</span> <span class="ot">=</span> <span class="st">"Immediate health care at a health center"</span>,</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Atención en urgencias sin posterior ingreso"</span> <span class="ot">=</span> <span class="st">"Emergency care without subsequent hospitalization"</span>,</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso superior a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso inferior o igual a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Fallecido 24 horas"</span> <span class="ot">=</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positive_alcohol <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positive_drug <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_died =</span> injury8 <span class="sc">==</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_hospitalized =</span> injury8 <span class="sc">%in%</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Died within 24 hours"</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type_person), <span class="sc">!</span><span class="fu">is.na</span>(gender))</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</section>
<section id="here_rel" class="level3">
<h3 class="anchored" data-anchor-id="here_rel"><code>here_rel()</code></h3>
<p><code>here::here()</code> is a function for specifying relative paths based on the project root directory. This ensures you don’t need to change paths if the project root directory changes. However, using <code>here::here()</code> within <code>_targets.R</code> saves absolute paths, which causes problems when sharing with others. Therefore, we use a function that maintains the convenience of <code>here::here()</code> while saving relative paths. This part is based on Dr.&nbsp;Andrew Heiss’s <a href="https://github.com/andrewheiss/lemon-lucifer/blob/main/_targets.R">code</a>.</p>
</section>
</section>
<section id="define-data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="define-data-cleaning">2. Define Data Cleaning</h2>
<p>Define your data cleaning pipeline. See the code here for details:</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>R/tar_data.R</summary>
<div class="code-with-filename-file">
<pre><strong>R/tar_data.R</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_raw_accident_bike =</span> <span class="fu">download_accident_bike</span>(<span class="fu">here_rel</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"accident_bike"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">raw_accident_bike =</span> <span class="fu">load_accident_bike</span>(dir_raw_accident_bike),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">accident_bike =</span> <span class="fu">clean_accident_bike</span>(raw_accident_bike)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>download_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_file) {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  url_base <span class="ot">&lt;-</span> <span class="st">"https://datos.madrid.es/egob/catalogo/300228-%s-accidentes-trafico-detalle.csv"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  keys <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>) <span class="co">#URL becomes caos since 2020</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_file)) {</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_file)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">pwalk</span>(\(year, key) {</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(url_base, key)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="fu">file.path</span>(dir_file, <span class="fu">paste0</span>(year, <span class="st">".txt"</span>)))</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dir_file)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>load_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_raw_accident_bike) {</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(dir_raw_accident_bike, <span class="fu">paste0</span>(.x, <span class="st">".txt"</span>)),</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">delim =</span> <span class="st">";"</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>clean_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_accident_bike) {</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  raw_accident_bike <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> num_expediente,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> fecha,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">hms =</span> hora,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">street =</span> localizacion,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">num_street =</span> numero,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_district =</span> cod_distrito,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> distrito,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_accident =</span> tipo_accidente,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> estado_meteorológico,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_vehicle =</span> tipo_vehiculo,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> tipo_persona,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> rango_edad,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> sexo,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_injury8 =</span> cod_lesividad,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> lesividad,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_x =</span> coordenada_x_utm,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_y =</span> coordenada_y_utm,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positiva_alcohol,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positiva_droga</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> lubridate<span class="sc">::</span><span class="fu">dmy_hms</span>(<span class="fu">paste0</span>(date, hms), <span class="at">tz =</span> <span class="st">"Europe/Madrid"</span>),</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> <span class="fu">na_if</span>(district, <span class="st">"NULL"</span>),</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(district),</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        weather,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Despejado"</span> <span class="ot">=</span> <span class="st">"sunny"</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nublado"</span> <span class="ot">=</span> <span class="st">"cloud"</span>,</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia débil"</span> <span class="ot">=</span> <span class="st">"soft rain"</span>,</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LLuvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nevando"</span> <span class="ot">=</span> <span class="st">"snow"</span>,</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Granizando"</span> <span class="ot">=</span> <span class="st">"hail"</span>,</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        type_person,</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Conductor"</span> <span class="ot">=</span> <span class="st">"Driver"</span>,</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pasajero"</span> <span class="ot">=</span> <span class="st">"Passenger"</span>,</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Peatón"</span> <span class="ot">=</span> <span class="st">"Pedestrian"</span>,</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        age_c,</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Menor de 5 años"</span> <span class="ot">=</span> <span class="st">"&lt;5"</span>,</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 6 a 9 años"</span> <span class="ot">=</span> <span class="st">"6-9"</span>,</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 10 a 14 años"</span> <span class="ot">=</span> <span class="st">"10-14"</span>,</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 15 a 17 años"</span> <span class="ot">=</span> <span class="st">"15-17"</span>,</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 18 a 20 años"</span> <span class="ot">=</span> <span class="st">"18-20"</span>,</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 21 a 24 años"</span> <span class="ot">=</span> <span class="st">"21-24"</span>,</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 25 a 29 años"</span> <span class="ot">=</span> <span class="st">"25-29"</span>,</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 30 a 34 años"</span> <span class="ot">=</span> <span class="st">"30-34"</span>,</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 35 a 39 años"</span> <span class="ot">=</span> <span class="st">"35-39"</span>,</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 40 a 44 años"</span> <span class="ot">=</span> <span class="st">"40-44"</span>,</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 45 a 49 años"</span> <span class="ot">=</span> <span class="st">"45-49"</span>,</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 50 a 54 años"</span> <span class="ot">=</span> <span class="st">"50-54"</span>,</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 55 a 59 años"</span> <span class="ot">=</span> <span class="st">"55-59"</span>,</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 60 a 64 años"</span> <span class="ot">=</span> <span class="st">"60-64"</span>,</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 65 a 69 años"</span> <span class="ot">=</span> <span class="st">"65-69"</span>,</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 70 a 74 años"</span> <span class="ot">=</span> <span class="st">"70-74"</span>,</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Más de 74 años"</span> <span class="ot">=</span> <span class="st">"&gt;74"</span>,</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>        gender,</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Hombre"</span> <span class="ot">=</span> <span class="st">"Men"</span>,</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Mujer"</span> <span class="ot">=</span> <span class="st">"Women"</span>,</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>        injury8,</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sin asistencia sanitaria"</span> <span class="ot">=</span> <span class="st">"No health care"</span>,</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria sólo en el lugar del accidente"</span> <span class="ot">=</span> <span class="st">"Healthcare only at the place of the accident"</span>,</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria ambulatoria con posterioridad"</span> <span class="ot">=</span> <span class="st">"Subsequent outpatient health care"</span>,</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria inmediata en centro de salud o mutua"</span> <span class="ot">=</span> <span class="st">"Immediate health care at a health center"</span>,</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Atención en urgencias sin posterior ingreso"</span> <span class="ot">=</span> <span class="st">"Emergency care without subsequent hospitalization"</span>,</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso superior a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso inferior o igual a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Fallecido 24 horas"</span> <span class="ot">=</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positive_alcohol <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positive_drug <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_died =</span> injury8 <span class="sc">==</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_hospitalized =</span> injury8 <span class="sc">%in%</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Died within 24 hours"</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type_person), <span class="sc">!</span><span class="fu">is.na</span>(gender))</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<p>The key points are:</p>
<ol type="1">
<li>Define raw data files with <code>tar_file()</code></li>
<li>Read raw data using functions like <code>readr::read_csv()</code></li>
<li>Create cleaning functions that take raw data as arguments and return cleaned data</li>
</ol>
<p>You can also combine the first two steps by <code>tar_file_read()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    data1_raw,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here_rel</span>(<span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"file"</span>, <span class="st">"data1.csv"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="sc">!!</span>.x),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data1_cleaned =</span> <span class="fu">clean_data1</span>(data1_raw)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To download online files and define them with <code>tar_file</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>download_file <span class="ot">&lt;-</span> <span class="cf">function</span>(url, destfile) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(destfile)) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url, destfile)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(destfile)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Define this function and call it within <code>tar_file()</code>. The key is to return the path to the saved file.</p>
<p>For your information, I have outlined my approach to data cleaning in this <a href="https://github.com/kazuyanagimoto/workshop-r-2022">workshop</a>.</p>
</section>
<section id="configure-the-website" class="level2">
<h2 class="anchored" data-anchor-id="configure-the-website">3. Configure the Website</h2>
<p>Use <code>tar_quarto()</code> to build a website within your pipeline. For the purpose of websites and specific configurations, see my blog post on <a href="https://kazuyanagimoto.com/blog/2024/04/05/">“Researching as if to Blog”</a>.</p>
</section>
<section id="experiment-with-data-analysis-and-models" class="level2">
<h2 class="anchored" data-anchor-id="experiment-with-data-analysis-and-models">4. Experiment with Data Analysis and Models</h2>
<p>Create notebook-style posts in the <code>playground</code> directory of your website to experiment with data analysis and models.</p>
<p>You can load cleaned data with <code>tar_load()</code>. I define figure settings in <code>R/fns_graphics.R</code> and import them when needed:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>posts/240324_accident_bike/index.qmd</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" data-filename="posts/240324_accident_bike/index.qmd"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytable)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">tar_config_set</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">store =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_targets"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_targets.R"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">tar_load</span>(<span class="fu">c</span>(accident_bike))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">list2env</span>(targets<span class="sc">::</span><span class="fu">tar_read</span>(fns_graphics), .GlobalEnv))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_proj</span>())</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The key is to avoid over-incorporating experiments into your pipeline. Most analyses in the experimental stage won’t make it into the final paper. Including them in the pipeline makes dependency management unnecessarily complex. Instead, experiment in the <code>playground</code> directory and only incorporate essential elements into the pipeline.</p>
<p>By combining <code>tar_quarto()</code> with Quarto’s <code>freeze: auto</code> setting, results are not recomputed unless you manually compile them. While this means that dependent parts won’t recalculate when upstream changes occur, it has the benefit of minimal management for unnecessary parts. If upstream changes do occur, you can manually recompile only the necessary parts of the project.</p>
</section>
<section id="summarize-interim-results-in-slides" class="level2">
<h2 class="anchored" data-anchor-id="summarize-interim-results-in-slides">5. Summarize Interim Results in Slides</h2>
<p>During research, you’ll often present interim results. It’s good practice to compile important findings from your experiments into slides. Like the experimental phase, this doesn’t need to be incorporated into the pipeline. In this project, the <code>slide</code> directory is compiled as part of the website.</p>
<p>I create slides using <a href="https://github.com/kazuyanagimoto/quarto-clean-typst">Quarto Clean Theme</a>. Since they’re created with Quarto, they integrate naturally into this workflow. Additionally, using Typst allows for faster compilation than Beamer. You can see the <a href="https://kazuyanagimoto.com/quarto-clean-typst/template-full.pdf">demo</a> for details.</p>
</section>
<section id="repeat-steps-3-5-and-incorporate-key-results-into-the-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="repeat-steps-3-5-and-incorporate-key-results-into-the-pipeline">6. Repeat Steps 3-5 and Incorporate Key Results into the Pipeline</h2>
<p>Continue your research, getting feedback from presentations. When you have sufficient results for your manuscript, proceed to the next step. This is where you define pipelines in files like <code>R/tar_fact.R</code> and <code>R/tar_model.R</code>.</p>
<section id="incorporate-key-results-into-the-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="incorporate-key-results-into-the-pipeline">Incorporate Key Results into the Pipeline</h3>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>R/tar_fact.R</summary>
<div class="code-with-filename-file">
<pre><strong>R/tar_fact.R</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fact <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_accident =</span> <span class="fu">compute_num_accident</span>(accident_bike),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">logit_hospital_death =</span> <span class="fu">compute_logit_hospital_death</span>(accident_bike)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>compute_num_accident <span class="ot">&lt;-</span> <span class="cf">function</span>(accident_bike) {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  accident_bike <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(type_person, gender))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>compute_logit_hospital_death <span class="ot">&lt;-</span> <span class="cf">function</span>(accident_bike) {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(1)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      is_hospitalized <span class="sc">~</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span> positive_alcohol <span class="sc">+</span> positive_drug <span class="sc">|</span> age_c <span class="sc">+</span> gender,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(2)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      is_hospitalized <span class="sc">~</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(3)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>      is_hospitalized <span class="sc">~</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle <span class="sc">+</span> weather,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(4)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>      is_died <span class="sc">~</span> type_person <span class="sc">+</span> positive_alcohol <span class="sc">+</span> positive_drug <span class="sc">|</span> age_c <span class="sc">+</span> gender,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(5)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      is_died <span class="sc">~</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle,</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(6)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>      is_died <span class="sc">~</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle <span class="sc">+</span> weather,</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<p>Incorporate figures needed for your paper into the pipeline. I define functions like <code>compute_*()</code> that take cleaned data as arguments and return calculated results as numbers or data frames. I don’t create figures here—I do that within the manuscript.</p>
<p>For LaTeX users, you might want to save figures at this stage. For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    fig1_file,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_fig1</span>(data1, <span class="fu">here_rel</span>(<span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"file"</span>, <span class="st">"fig1.pdf"</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plot_fig1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data1, path_fig1) {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data1, <span class="fu">aes</span>(<span class="at">x =</span> col1, <span class="at">y =</span> col2)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(path_fig1)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(path_fig1)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="incorporate-julia-code-into-the-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="incorporate-julia-code-into-the-pipeline">Incorporate Julia Code into the Pipeline</h3>
<p>While R analyses can be directly incorporated into the pipeline, Julia code requires some extra steps. Here’s my approach:</p>
<ol type="1">
<li>Load Julia source code files with <code>tar_file_read()</code> and incorporate them as <code>jl_file_*</code></li>
<li>Execute Julia code from R using <code>system2()</code> via the <code>run_model()</code> function</li>
<li>Save Julia execution results as CSV or YAML files for loading in R with <code>tar_file_read()</code></li>
</ol>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>R/tar_model.R</summary>
<div class="code-with-filename-file">
<pre><strong>R/tar_model.R</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_map</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"main"</span>, <span class="st">"model"</span>)),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> name,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_file_read</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      jl,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">here_rel</span>(<span class="st">"Julia"</span>, <span class="fu">paste0</span>(name, <span class="st">".jl"</span>)),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">readLines</span>(<span class="sc">!!</span>.x)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">res_model =</span> <span class="fu">run_model</span>(jl_file_main, jl_main, jl_model),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    parameters,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    res_model[[<span class="dv">1</span>]],</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="sc">!!</span>.x)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    demand_supply,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    res_model[[<span class="dv">2</span>]],</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read.csv</span>(<span class="sc">!!</span>.x)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    equilibrium,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    res_model[[<span class="dv">3</span>]],</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="sc">!!</span>.x)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>run_model <span class="ot">&lt;-</span> <span class="cf">function</span>(jl_file_main, ...) {</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system2</span>(<span class="at">command =</span> <span class="st">"julia"</span>, <span class="at">args =</span> <span class="fu">c</span>(<span class="st">"--project=."</span>, jl_file_main))</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">file.path</span>(</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here_rel</span>(<span class="st">"output"</span>, <span class="st">"Julia"</span>),</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"parameters.yaml"</span>, <span class="st">"demand_supply.csv"</span>, <span class="st">"equilibrium.yaml"</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<p>The key points are:</p>
<ol type="1">
<li>Specify all dependencies in <code>run_model()</code> arguments to include Julia dependencies</li>
<li>Group saved result files into a list and load them one by one from R</li>
</ol>
<p>When executing with <code>system2()</code>, Julia’s path might not be accessible (due to differences between your PC’s default shell and R’s shell). In that case, define Julia’s path in <code>.Renviron</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.Renviron</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" data-filename=".Renviron"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="va">PATH_JULIA</span><span class="op">=</span>/path/to/julia/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And load it in <code>.Rprofile</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.Rprofile</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" data-filename=".Rprofile"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"renv/activate.R"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">PATH =</span> <span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">"PATH_JULIA"</span>), <span class="fu">Sys.getenv</span>(<span class="st">"PATH"</span>), <span class="at">sep =</span> <span class="st">":"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="write-the-manuscript-with-final-results" class="level2">
<h2 class="anchored" data-anchor-id="write-the-manuscript-with-final-results">7. Write the Manuscript with Final Results</h2>
<p>Write your manuscript in the <code>manuscript</code> directory. Here, load the pipeline execution results with <code>tar_load()</code>. I use these three steps:</p>
<ol type="1">
<li>Configure the directory as a <a href="https://quarto.org/docs/books/">Quarto Book</a> in <code>manuscript/_quarto.yml</code></li>
<li>Write the Quarto Book as <code>01-intro.qmd</code>, etc.</li>
<li>Combine <code>01-intro.qmd</code>, <code>02-methods.qmd</code>, etc. in <code>manuscript/main.qmd</code> (using <code>{{&lt; include **-**.qmd &gt;}}</code>) and compile</li>
</ol>
<section id="why-write-as-a-quarto-book" class="level3">
<h3 class="anchored" data-anchor-id="why-write-as-a-quarto-book">Why Write as a Quarto Book?</h3>
<p>Writing as a Quarto Book enables cross-references across multiple files. This is very convenient—dividing your manuscript into files by section makes the structure easier to grasp, and cross-reference auto-completion makes writing smoother.</p>
<p>However, the Quarto Book output format isn’t ideal for papers, so I combine these files and compile them in <code>manuscript/main.qmd</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>manuscript/main.qmd</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13" data-filename="manuscript/main.qmd"><pre class="sourceCode md code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>{{&lt; include 01-intro.qmd &gt;}}</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>{{&lt; include 02-fact.qmd &gt;}}</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>{{&lt; include 03-model.qmd &gt;}}</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>{{&lt; include 04-result.qmd &gt;}}</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>{{&lt; include 05-conclusion.qmd &gt;}}</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>{{&lt; appendix &gt;}}</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>{{&lt; include 11-data.qmd &gt;}}</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>{{&lt; pagebreak &gt;}}</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>:::{#refs}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>:::</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I use Typst as the backend for fast compilation and the <a href="https://github.com/kazuyanagimoto/quarto-academic-typst">quarto-academic-typst</a> template. If you need LaTeX source code, you can generate it with <code>quarto::quarto_render()</code> (I used this for my doctoral thesis to match the LaTeX template).</p>
</section>
<section id="for-latex-users" class="level3">
<h3 class="anchored" data-anchor-id="for-latex-users">For LaTeX Users</h3>
<p>If you’re writing in LaTeX and compiling with <code>TinyTeX</code>, you can incorporate it into the pipeline. For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    manuscript,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here_rel</span>(<span class="st">"manuscript"</span>, <span class="st">"main.tex"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">readLines</span>(<span class="sc">!!</span>.x)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    manuscript_pdf,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compile_latex</span>(manuscript, <span class="fu">here_rel</span>(<span class="st">"manuscript"</span>, <span class="st">"main.pdf"</span>))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>compile_latex <span class="ot">&lt;-</span> <span class="cf">function</span>(manuscript_file, path_pdf) {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  tinytex<span class="sc">::</span><span class="fu">xelatex</span>(</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    manuscript_file,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> path_pdf</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pdf_file =</span> path_pdf</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(path_pdf)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Note that you may need to include all figure and table dependencies.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I’ve explained a research workflow using Quarto + <code>{targets}</code>. While <code>{targets}</code> might be somewhat challenging at first, trusting in it and maintaining an executable state will help you maintain reproducibility. Ultimately, this should help you conduct your research more efficiently.</p>
<p>Happy Quarto + {targets} Life! 🥂</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/kazuyanagimoto\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "kazuyanagimoto/kazuyanagimoto.github.io";
    script.dataset.repoId = "R_kgDOHSlYJQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOHSlYJc4CWQ7Q";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Research Workflow with Quarto + {targets}</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-04-26</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Kazuharu Yanagimoto</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Quarto, R, Julia]</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> img/thumbnail.png</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu"># Let {targets} Take the Lead</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`{targets}`</span><span class="co">](https://books.ropensci.org/targets/)</span> is an R package for building research workflows. Its primary feature is managing R objects (data, functions, and results) and their dependencies, automatically recalculating downstream objects when upstream objects change. This allows you to maintain reproducibility throughout your research process.</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>When combined with <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org/)</span>, you can manage all aspects of your research workflow in a single pipeline—from interim reports and slides to writing the final manuscript. This article explains a Quarto + {targets} research workflow I actively use in my own research. While the final pipeline is a clean and simple workflow, I also add flexibility for experimentation and iteration.</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>The code is available <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/kazuyanagimoto/quarto-research-blog/)</span>. Please refer to it for code examples and directory structure.</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">## Workflow</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Set up initial configuration in <span class="in">`_targets.R`</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Define data cleaning in <span class="in">`R/tar_data.R`</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Configure the website in <span class="in">`_quarto.yml`</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Experiment with data analysis and models in <span class="in">`playground/yymmdd_*/index.qmd`</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Summarize interim results in slides <span class="in">`slide/yymmdd_*/index.qmd`</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Repeat steps 3-5. Incorporate key results into the pipeline via <span class="in">`R/tar_fact.R`</span>, <span class="in">`R/tar_model.R`</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Write the manuscript with final results in <span class="in">`manuscript/*.qmd`</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>By the time you finish writing your manuscript, you should have a pipeline like the one below. This was generated using <span class="in">`targets::tar_mermaid()`</span>.</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid mermaid}</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>graph LR</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  style Graph fill:<span class="co">#FFFFFF00,stroke:#000000;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  subgraph Graph</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    direction LR</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    xa60862c4ab4296bb([<span class="ot">"</span><span class="st">raw_accident_bike</span><span class="ot">"</span>]):::skipped --&gt; x034caa8952fea0bc([<span class="ot">"</span><span class="st">accident_bike</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    x6d55c198484f4a32([<span class="ot">"</span><span class="st">demand_supply_file</span><span class="ot">"</span>]):::skipped --&gt; xce43a680ab7f20d8([<span class="ot">"</span><span class="st">demand_supply</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    x6b88c7f0a7cfeae2([<span class="ot">"</span><span class="st">res_model</span><span class="ot">"</span>]):::skipped --&gt; x6d55c198484f4a32([<span class="ot">"</span><span class="st">demand_supply_file</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    xae87dc67ba338d4f([<span class="ot">"</span><span class="st">equilibrium_file</span><span class="ot">"</span>]):::skipped --&gt; xa24c4be63b494044([<span class="ot">"</span><span class="st">equilibrium</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    x6b88c7f0a7cfeae2([<span class="ot">"</span><span class="st">res_model</span><span class="ot">"</span>]):::skipped --&gt; xae87dc67ba338d4f([<span class="ot">"</span><span class="st">equilibrium_file</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    x02d319b13cb530b9([<span class="ot">"</span><span class="st">jl_file_main</span><span class="ot">"</span>]):::skipped --&gt; xad77b747e8ecd697([<span class="ot">"</span><span class="st">jl_main</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    x693460ba53a4c0cd([<span class="ot">"</span><span class="st">jl_file_model</span><span class="ot">"</span>]):::skipped --&gt; x25bf76549192ec22([<span class="ot">"</span><span class="st">jl_model</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    x034caa8952fea0bc([<span class="ot">"</span><span class="st">accident_bike</span><span class="ot">"</span>]):::skipped --&gt; x9470f51581cb7d73([<span class="ot">"</span><span class="st">logit_hospital_death</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    xce43a680ab7f20d8([<span class="ot">"</span><span class="st">demand_supply</span><span class="ot">"</span>]):::skipped --&gt; x24abe6175c545e8a([<span class="ot">"</span><span class="st">manuscript</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    xb033ae8b49095a26([<span class="ot">"</span><span class="st">num_accident</span><span class="ot">"</span>]):::skipped --&gt; x24abe6175c545e8a([<span class="ot">"</span><span class="st">manuscript</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    xa24c4be63b494044([<span class="ot">"</span><span class="st">equilibrium</span><span class="ot">"</span>]):::skipped --&gt; x24abe6175c545e8a([<span class="ot">"</span><span class="st">manuscript</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    x9470f51581cb7d73([<span class="ot">"</span><span class="st">logit_hospital_death</span><span class="ot">"</span>]):::skipped --&gt; x24abe6175c545e8a([<span class="ot">"</span><span class="st">manuscript</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    x5b3deba9281c9212([<span class="ot">"</span><span class="st">fns_graphics</span><span class="ot">"</span>]):::skipped --&gt; x24abe6175c545e8a([<span class="ot">"</span><span class="st">manuscript</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    x41180a2d7b7b3c28([<span class="ot">"</span><span class="st">parameters</span><span class="ot">"</span>]):::skipped --&gt; x24abe6175c545e8a([<span class="ot">"</span><span class="st">manuscript</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    xb033ae8b49095a26([<span class="ot">"</span><span class="st">num_accident</span><span class="ot">"</span>]):::skipped --&gt; xb7f5b6c7e9273aa9([<span class="ot">"</span><span class="st">manuscript_book</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    xce43a680ab7f20d8([<span class="ot">"</span><span class="st">demand_supply</span><span class="ot">"</span>]):::skipped --&gt; xb7f5b6c7e9273aa9([<span class="ot">"</span><span class="st">manuscript_book</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    xa24c4be63b494044([<span class="ot">"</span><span class="st">equilibrium</span><span class="ot">"</span>]):::skipped --&gt; xb7f5b6c7e9273aa9([<span class="ot">"</span><span class="st">manuscript_book</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    x9470f51581cb7d73([<span class="ot">"</span><span class="st">logit_hospital_death</span><span class="ot">"</span>]):::skipped --&gt; xb7f5b6c7e9273aa9([<span class="ot">"</span><span class="st">manuscript_book</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    x5b3deba9281c9212([<span class="ot">"</span><span class="st">fns_graphics</span><span class="ot">"</span>]):::skipped --&gt; xb7f5b6c7e9273aa9([<span class="ot">"</span><span class="st">manuscript_book</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    x41180a2d7b7b3c28([<span class="ot">"</span><span class="st">parameters</span><span class="ot">"</span>]):::skipped --&gt; xb7f5b6c7e9273aa9([<span class="ot">"</span><span class="st">manuscript_book</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    x034caa8952fea0bc([<span class="ot">"</span><span class="st">accident_bike</span><span class="ot">"</span>]):::skipped --&gt; xb033ae8b49095a26([<span class="ot">"</span><span class="st">num_accident</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    xfeeaf8513320133e([<span class="ot">"</span><span class="st">parameters_file</span><span class="ot">"</span>]):::skipped --&gt; x41180a2d7b7b3c28([<span class="ot">"</span><span class="st">parameters</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    x6b88c7f0a7cfeae2([<span class="ot">"</span><span class="st">res_model</span><span class="ot">"</span>]):::skipped --&gt; xfeeaf8513320133e([<span class="ot">"</span><span class="st">parameters_file</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    xee0a5a7de02f740f([<span class="ot">"</span><span class="st">dir_raw_accident_bike</span><span class="ot">"</span>]):::skipped --&gt; xa60862c4ab4296bb([<span class="ot">"</span><span class="st">raw_accident_bike</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    x02d319b13cb530b9([<span class="ot">"</span><span class="st">jl_file_main</span><span class="ot">"</span>]):::skipped --&gt; x6b88c7f0a7cfeae2([<span class="ot">"</span><span class="st">res_model</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    xad77b747e8ecd697([<span class="ot">"</span><span class="st">jl_main</span><span class="ot">"</span>]):::skipped --&gt; x6b88c7f0a7cfeae2([<span class="ot">"</span><span class="st">res_model</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    x25bf76549192ec22([<span class="ot">"</span><span class="st">jl_model</span><span class="ot">"</span>]):::skipped --&gt; x6b88c7f0a7cfeae2([<span class="ot">"</span><span class="st">res_model</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    x034caa8952fea0bc([<span class="ot">"</span><span class="st">accident_bike</span><span class="ot">"</span>]):::skipped --&gt; x5a3744590d99f661([<span class="ot">"</span><span class="st">website</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    x5b3deba9281c9212([<span class="ot">"</span><span class="st">fns_graphics</span><span class="ot">"</span>]):::skipped --&gt; x5a3744590d99f661([<span class="ot">"</span><span class="st">website</span><span class="ot">"</span>]):::skipped</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>Before explaining each part of the workflow, let's cover the basics of <span class="in">`{targets}`</span>.</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## {targets} Basics</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>The official <span class="co">[</span><span class="ot">tutorial</span><span class="co">](https://books.ropensci.org/targets/)</span> is the best way to learn <span class="in">`{targets}`</span> basics, but in practice, we often use the extended syntax from <span class="in">`{tarchetypes}`</span>. Here, I'll explain a minimal usage based on <span class="in">`{tarchetypes}`</span> syntax. This <span class="co">[</span><span class="ot">tutorial</span><span class="co">](https://carpentries-incubator.github.io/targets-workshop/index.html)</span> was helpful for transitioning from <span class="in">`{targets}`</span> to <span class="in">`{tarchetypes}`</span>.</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Three Basic Elements</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>The philosophy of <span class="in">`{targets}`</span> divides research workflows into three elements: _files_, _functions_, and _objects_.</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>_Files_: Objects defined with <span class="in">`tar_file()`</span> that hold file paths. They also store file size and timestamp, so even if the path hasn't changed, if the content changes, dependent parts of the pipeline will be recalculated.</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>_Objects_: Variables, data frames, and other R objects.</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>_Functions_: R functions. All inputs that the function depends on must be specified, and the output must be a file or object. This makes dependencies explicit.</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>Conceptually, you start with files, read them to create objects, and then use those objects to run functions that create new objects. These elements are defined within <span class="in">`tar_plan()`</span>.</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>clean_data1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data1_raw) {</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>  data1_raw <span class="sc">|&gt;</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(col1))</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file</span>(data1_raw_file, <span class="st">"path/to/file/data1.csv"</span>),</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">data1_raw =</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(data1_raw_file),</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">data1_cleaned =</span> <span class="fu">clean_data1</span>(data1_raw),</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>In the example above, <span class="in">`data1_raw_file`</span> is a file, <span class="in">`data1_raw`</span> and <span class="in">`data1_cleaned`</span> are objects, and <span class="in">`readr::read_csv`</span> and <span class="in">`clean_data1()`</span> are functions.</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a><span class="fu">### Execution and Dependency Management</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>You can visualize your defined pipeline with <span class="in">`targets::tar_visnetwork()`</span>.</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/step0.png)</span>{width=80% fig-align="center"}</span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>Here, triangles represent functions, and circles represent files and objects. The light blue color indicates parts of the pipeline that haven't been executed yet. When you run <span class="in">`targets::tar_make()`</span>:</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/step1.png)</span>{width=80% fig-align="center"}</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>Successfully executed parts turn gray. If you change the contents of <span class="in">`data1.csv`</span> (<span class="in">`data1_raw_file`</span>):</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/step2-1.png)</span>{width=80% fig-align="center"}</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>Parts with dependencies return to the unexecuted state. Of course, running <span class="in">`targets::tar_make()`</span> again will recalculate the dependent parts:</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/step1.png)</span>{width=80% fig-align="center"}</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>Similarly, if you change the contents of the <span class="in">`clean_data1()`</span> function:</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/step2-2.png)</span>{width=80% fig-align="center"}</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>This is the basic workflow of <span class="in">`{targets}`</span>: define pipelines in <span class="in">`tar_plan()`</span>, then execute them with <span class="in">`tar_make()`</span>.</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a><span class="fu"># Quarto + {targets} Workflow</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Initial Configuration in `_targets.R`</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r filename="_targets.R"}</span></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes)</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidyverse.quiet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">readr.show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a><span class="co"># here::here() returns an absolute path, which then gets stored in tar_meta and</span></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a><span class="co"># becomes computer-specific (i.e. /Users/andrew/Research/blah/thing.Rmd).</span></span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a><span class="co"># There's no way to get a relative path directly out of here::here(), but</span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a><span class="co"># fs::path_rel() works fine with it (see</span></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/r-lib/here/issues/36#issuecomment-530894167)</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>here_rel <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">path_rel</span>(here<span class="sc">::</span><span class="fu">here</span>(...))</span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_source</span>()</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Main Pipeline</span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data Preparation ----------</span></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Analysis ------------------</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>  fact,</span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a>  model,</span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Graphics ------------------</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">fns_graphics =</span> <span class="fu">lst</span>(theme_proj, color_base, color_accent, scale_fill_gender),</span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Manuscript ----------------</span></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(manuscript_book, <span class="at">path =</span> <span class="st">"manuscript"</span>, <span class="at">quiet =</span> <span class="cn">FALSE</span>),</span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(manuscript, <span class="at">path =</span> <span class="st">"manuscript/main.qmd"</span>, <span class="at">quiet =</span> <span class="cn">FALSE</span>),</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Website -------------------</span></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_quarto</span>(</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>    website,</span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">"."</span>,</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">extra_files =</span> <span class="fu">here_rel</span>(<span class="st">"manuscript"</span>, <span class="st">"main.pdf"</span>)</span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>The three crucial parts are:</span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### `tar_source()`</span></span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>Specifies the directory containing source code for functions used in your pipeline. By default, the <span class="in">`R/`</span> directory is specified.</span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a><span class="fu">### `tar_plan()`</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>Defines the pipeline. You don't need to include every pipeline element here—you can define pipelines in files loaded via <span class="in">`tar_source()`</span> and call them. For example, the <span class="in">`data`</span> pipeline is defined in <span class="in">`R/tar_data.R`</span>:</span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="R/tar_data.R"}</span></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar_data</span></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: R/tar_data.R</span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_raw_accident_bike =</span> <span class="fu">download_accident_bike</span>(<span class="fu">here_rel</span>(</span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>,</span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>    <span class="st">"accident_bike"</span></span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">raw_accident_bike =</span> <span class="fu">load_accident_bike</span>(dir_raw_accident_bike),</span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">accident_bike =</span> <span class="fu">clean_accident_bike</span>(raw_accident_bike)</span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>download_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_file) {</span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a>  url_base <span class="ot">&lt;-</span> <span class="st">"https://datos.madrid.es/egob/catalogo/300228-%s-accidentes-trafico-detalle.csv"</span></span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a>  keys <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>) <span class="co">#URL becomes caos since 2020</span></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_file)) {</span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_file)</span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>)</span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">pwalk</span>(\(year, key) {</span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(url_base, key)</span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="fu">file.path</span>(dir_file, <span class="fu">paste0</span>(year, <span class="st">".txt"</span>)))</span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dir_file)</span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a>load_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_raw_accident_bike) {</span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(dir_raw_accident_bike, <span class="fu">paste0</span>(.x, <span class="st">".txt"</span>)),</span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a>      <span class="at">delim =</span> <span class="st">";"</span></span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a>clean_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_accident_bike) {</span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a>  raw_accident_bike <span class="sc">|&gt;</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> num_expediente,</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> fecha,</span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>      <span class="at">hms =</span> hora,</span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>      <span class="at">street =</span> localizacion,</span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>      <span class="at">num_street =</span> numero,</span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_district =</span> cod_distrito,</span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> distrito,</span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_accident =</span> tipo_accidente,</span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> estado_meteorológico,</span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_vehicle =</span> tipo_vehiculo,</span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> tipo_persona,</span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> rango_edad,</span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> sexo,</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_injury8 =</span> cod_lesividad,</span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> lesividad,</span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_x =</span> coordenada_x_utm,</span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_y =</span> coordenada_y_utm,</span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positiva_alcohol,</span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positiva_droga</span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> lubridate<span class="sc">::</span><span class="fu">dmy_hms</span>(<span class="fu">paste0</span>(date, hms), <span class="at">tz =</span> <span class="st">"Europe/Madrid"</span>),</span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> <span class="fu">na_if</span>(district, <span class="st">"NULL"</span>),</span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(district),</span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a>        weather,</span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Despejado"</span> <span class="ot">=</span> <span class="st">"sunny"</span>,</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nublado"</span> <span class="ot">=</span> <span class="st">"cloud"</span>,</span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia débil"</span> <span class="ot">=</span> <span class="st">"soft rain"</span>,</span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LLuvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nevando"</span> <span class="ot">=</span> <span class="st">"snow"</span>,</span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Granizando"</span> <span class="ot">=</span> <span class="st">"hail"</span>,</span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a>        type_person,</span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Conductor"</span> <span class="ot">=</span> <span class="st">"Driver"</span>,</span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pasajero"</span> <span class="ot">=</span> <span class="st">"Passenger"</span>,</span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Peatón"</span> <span class="ot">=</span> <span class="st">"Pedestrian"</span>,</span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a>        age_c,</span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Menor de 5 años"</span> <span class="ot">=</span> <span class="st">"&lt;5"</span>,</span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 6 a 9 años"</span> <span class="ot">=</span> <span class="st">"6-9"</span>,</span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 10 a 14 años"</span> <span class="ot">=</span> <span class="st">"10-14"</span>,</span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 15 a 17 años"</span> <span class="ot">=</span> <span class="st">"15-17"</span>,</span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 18 a 20 años"</span> <span class="ot">=</span> <span class="st">"18-20"</span>,</span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 21 a 24 años"</span> <span class="ot">=</span> <span class="st">"21-24"</span>,</span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 25 a 29 años"</span> <span class="ot">=</span> <span class="st">"25-29"</span>,</span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 30 a 34 años"</span> <span class="ot">=</span> <span class="st">"30-34"</span>,</span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 35 a 39 años"</span> <span class="ot">=</span> <span class="st">"35-39"</span>,</span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 40 a 44 años"</span> <span class="ot">=</span> <span class="st">"40-44"</span>,</span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 45 a 49 años"</span> <span class="ot">=</span> <span class="st">"45-49"</span>,</span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 50 a 54 años"</span> <span class="ot">=</span> <span class="st">"50-54"</span>,</span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 55 a 59 años"</span> <span class="ot">=</span> <span class="st">"55-59"</span>,</span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 60 a 64 años"</span> <span class="ot">=</span> <span class="st">"60-64"</span>,</span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 65 a 69 años"</span> <span class="ot">=</span> <span class="st">"65-69"</span>,</span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 70 a 74 años"</span> <span class="ot">=</span> <span class="st">"70-74"</span>,</span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Más de 74 años"</span> <span class="ot">=</span> <span class="st">"&gt;74"</span>,</span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a>        gender,</span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Hombre"</span> <span class="ot">=</span> <span class="st">"Men"</span>,</span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Mujer"</span> <span class="ot">=</span> <span class="st">"Women"</span>,</span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a>        injury8,</span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sin asistencia sanitaria"</span> <span class="ot">=</span> <span class="st">"No health care"</span>,</span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria sólo en el lugar del accidente"</span> <span class="ot">=</span> <span class="st">"Healthcare only at the place of the accident"</span>,</span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria ambulatoria con posterioridad"</span> <span class="ot">=</span> <span class="st">"Subsequent outpatient health care"</span>,</span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria inmediata en centro de salud o mutua"</span> <span class="ot">=</span> <span class="st">"Immediate health care at a health center"</span>,</span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Atención en urgencias sin posterior ingreso"</span> <span class="ot">=</span> <span class="st">"Emergency care without subsequent hospitalization"</span>,</span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso superior a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso inferior o igual a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Fallecido 24 horas"</span> <span class="ot">=</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positive_alcohol <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positive_drug <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_died =</span> injury8 <span class="sc">==</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_hospitalized =</span> injury8 <span class="sc">%in%</span></span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Died within 24 hours"</span></span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type_person), <span class="sc">!</span><span class="fu">is.na</span>(gender))</span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a><span class="fu">### `here_rel()`</span></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a><span class="in">`here::here()`</span> is a function for specifying relative paths based on the project root directory. This ensures you don't need to change paths if the project root directory changes. However, using <span class="in">`here::here()`</span> within <span class="in">`_targets.R`</span> saves absolute paths, which causes problems when sharing with others. Therefore, we use a function that maintains the convenience of <span class="in">`here::here()`</span> while saving relative paths. This part is based on Dr. Andrew Heiss's <span class="co">[</span><span class="ot">code</span><span class="co">](https://github.com/andrewheiss/lemon-lucifer/blob/main/_targets.R)</span>.</span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Define Data Cleaning</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a>Define your data cleaning pipeline. See the code here for details:</span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="R/tar_data.R"}</span></span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar_data-2</span></span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: R/tar_data.R</span></span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_raw_accident_bike =</span> <span class="fu">download_accident_bike</span>(<span class="fu">here_rel</span>(</span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span>,</span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a>    <span class="st">"accident_bike"</span></span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">raw_accident_bike =</span> <span class="fu">load_accident_bike</span>(dir_raw_accident_bike),</span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">accident_bike =</span> <span class="fu">clean_accident_bike</span>(raw_accident_bike)</span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a>download_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_file) {</span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a>  url_base <span class="ot">&lt;-</span> <span class="st">"https://datos.madrid.es/egob/catalogo/300228-%s-accidentes-trafico-detalle.csv"</span></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a>  keys <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>) <span class="co">#URL becomes caos since 2020</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dir_file)) {</span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_file)</span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">26</span>)</span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">pwalk</span>(\(year, key) {</span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(url_base, key)</span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="fu">file.path</span>(dir_file, <span class="fu">paste0</span>(year, <span class="st">".txt"</span>)))</span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dir_file)</span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a>load_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(dir_raw_accident_bike) {</span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(dir_raw_accident_bike, <span class="fu">paste0</span>(.x, <span class="st">".txt"</span>)),</span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a>      <span class="at">delim =</span> <span class="st">";"</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a>clean_accident_bike <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_accident_bike) {</span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a>  raw_accident_bike <span class="sc">|&gt;</span></span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> num_expediente,</span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> fecha,</span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a>      <span class="at">hms =</span> hora,</span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a>      <span class="at">street =</span> localizacion,</span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a>      <span class="at">num_street =</span> numero,</span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_district =</span> cod_distrito,</span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> distrito,</span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_accident =</span> tipo_accidente,</span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> estado_meteorológico,</span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_vehicle =</span> tipo_vehiculo,</span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> tipo_persona,</span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> rango_edad,</span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> sexo,</span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a>      <span class="at">code_injury8 =</span> cod_lesividad,</span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> lesividad,</span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_x =</span> coordenada_x_utm,</span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a>      <span class="at">coord_y =</span> coordenada_y_utm,</span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positiva_alcohol,</span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positiva_droga</span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> lubridate<span class="sc">::</span><span class="fu">dmy_hms</span>(<span class="fu">paste0</span>(date, hms), <span class="at">tz =</span> <span class="st">"Europe/Madrid"</span>),</span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> <span class="fu">na_if</span>(district, <span class="st">"NULL"</span>),</span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a>      <span class="at">district =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(district),</span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a>      <span class="at">weather =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a>        weather,</span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Despejado"</span> <span class="ot">=</span> <span class="st">"sunny"</span>,</span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nublado"</span> <span class="ot">=</span> <span class="st">"cloud"</span>,</span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia débil"</span> <span class="ot">=</span> <span class="st">"soft rain"</span>,</span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lluvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LLuvia intensa"</span> <span class="ot">=</span> <span class="st">"hard rain"</span>,</span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Nevando"</span> <span class="ot">=</span> <span class="st">"snow"</span>,</span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Granizando"</span> <span class="ot">=</span> <span class="st">"hail"</span>,</span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_person =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true" tabindex="-1"></a>        type_person,</span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Conductor"</span> <span class="ot">=</span> <span class="st">"Driver"</span>,</span>
<span id="cb15-425"><a href="#cb15-425" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pasajero"</span> <span class="ot">=</span> <span class="st">"Passenger"</span>,</span>
<span id="cb15-426"><a href="#cb15-426" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Peatón"</span> <span class="ot">=</span> <span class="st">"Pedestrian"</span>,</span>
<span id="cb15-427"><a href="#cb15-427" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-428"><a href="#cb15-428" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-429"><a href="#cb15-429" aria-hidden="true" tabindex="-1"></a>      <span class="at">age_c =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-430"><a href="#cb15-430" aria-hidden="true" tabindex="-1"></a>        age_c,</span>
<span id="cb15-431"><a href="#cb15-431" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Menor de 5 años"</span> <span class="ot">=</span> <span class="st">"&lt;5"</span>,</span>
<span id="cb15-432"><a href="#cb15-432" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 6 a 9 años"</span> <span class="ot">=</span> <span class="st">"6-9"</span>,</span>
<span id="cb15-433"><a href="#cb15-433" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 10 a 14 años"</span> <span class="ot">=</span> <span class="st">"10-14"</span>,</span>
<span id="cb15-434"><a href="#cb15-434" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 15 a 17 años"</span> <span class="ot">=</span> <span class="st">"15-17"</span>,</span>
<span id="cb15-435"><a href="#cb15-435" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 18 a 20 años"</span> <span class="ot">=</span> <span class="st">"18-20"</span>,</span>
<span id="cb15-436"><a href="#cb15-436" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 21 a 24 años"</span> <span class="ot">=</span> <span class="st">"21-24"</span>,</span>
<span id="cb15-437"><a href="#cb15-437" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 25 a 29 años"</span> <span class="ot">=</span> <span class="st">"25-29"</span>,</span>
<span id="cb15-438"><a href="#cb15-438" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 30 a 34 años"</span> <span class="ot">=</span> <span class="st">"30-34"</span>,</span>
<span id="cb15-439"><a href="#cb15-439" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 35 a 39 años"</span> <span class="ot">=</span> <span class="st">"35-39"</span>,</span>
<span id="cb15-440"><a href="#cb15-440" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 40 a 44 años"</span> <span class="ot">=</span> <span class="st">"40-44"</span>,</span>
<span id="cb15-441"><a href="#cb15-441" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 45 a 49 años"</span> <span class="ot">=</span> <span class="st">"45-49"</span>,</span>
<span id="cb15-442"><a href="#cb15-442" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 50 a 54 años"</span> <span class="ot">=</span> <span class="st">"50-54"</span>,</span>
<span id="cb15-443"><a href="#cb15-443" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 55 a 59 años"</span> <span class="ot">=</span> <span class="st">"55-59"</span>,</span>
<span id="cb15-444"><a href="#cb15-444" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 60 a 64 años"</span> <span class="ot">=</span> <span class="st">"60-64"</span>,</span>
<span id="cb15-445"><a href="#cb15-445" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 65 a 69 años"</span> <span class="ot">=</span> <span class="st">"65-69"</span>,</span>
<span id="cb15-446"><a href="#cb15-446" aria-hidden="true" tabindex="-1"></a>        <span class="st">"De 70 a 74 años"</span> <span class="ot">=</span> <span class="st">"70-74"</span>,</span>
<span id="cb15-447"><a href="#cb15-447" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Más de 74 años"</span> <span class="ot">=</span> <span class="st">"&gt;74"</span>,</span>
<span id="cb15-448"><a href="#cb15-448" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-449"><a href="#cb15-449" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-450"><a href="#cb15-450" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-451"><a href="#cb15-451" aria-hidden="true" tabindex="-1"></a>        gender,</span>
<span id="cb15-452"><a href="#cb15-452" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Hombre"</span> <span class="ot">=</span> <span class="st">"Men"</span>,</span>
<span id="cb15-453"><a href="#cb15-453" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Mujer"</span> <span class="ot">=</span> <span class="st">"Women"</span>,</span>
<span id="cb15-454"><a href="#cb15-454" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Desconocido"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-455"><a href="#cb15-455" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-456"><a href="#cb15-456" aria-hidden="true" tabindex="-1"></a>      <span class="at">injury8 =</span> <span class="fu">recode_factor</span>(</span>
<span id="cb15-457"><a href="#cb15-457" aria-hidden="true" tabindex="-1"></a>        injury8,</span>
<span id="cb15-458"><a href="#cb15-458" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sin asistencia sanitaria"</span> <span class="ot">=</span> <span class="st">"No health care"</span>,</span>
<span id="cb15-459"><a href="#cb15-459" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria sólo en el lugar del accidente"</span> <span class="ot">=</span> <span class="st">"Healthcare only at the place of the accident"</span>,</span>
<span id="cb15-460"><a href="#cb15-460" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria ambulatoria con posterioridad"</span> <span class="ot">=</span> <span class="st">"Subsequent outpatient health care"</span>,</span>
<span id="cb15-461"><a href="#cb15-461" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Asistencia sanitaria inmediata en centro de salud o mutua"</span> <span class="ot">=</span> <span class="st">"Immediate health care at a health center"</span>,</span>
<span id="cb15-462"><a href="#cb15-462" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Atención en urgencias sin posterior ingreso"</span> <span class="ot">=</span> <span class="st">"Emergency care without subsequent hospitalization"</span>,</span>
<span id="cb15-463"><a href="#cb15-463" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso superior a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb15-464"><a href="#cb15-464" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ingreso inferior o igual a 24 horas"</span> <span class="ot">=</span> <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb15-465"><a href="#cb15-465" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Fallecido 24 horas"</span> <span class="ot">=</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb15-466"><a href="#cb15-466" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Se desconoce"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb15-467"><a href="#cb15-467" aria-hidden="true" tabindex="-1"></a>        <span class="st">"NULL"</span> <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb15-468"><a href="#cb15-468" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-469"><a href="#cb15-469" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_alcohol =</span> positive_alcohol <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb15-470"><a href="#cb15-470" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive_drug =</span> positive_drug <span class="sc">==</span> <span class="st">"S"</span>,</span>
<span id="cb15-471"><a href="#cb15-471" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_died =</span> injury8 <span class="sc">==</span> <span class="st">"Died within 24 hours"</span>,</span>
<span id="cb15-472"><a href="#cb15-472" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_hospitalized =</span> injury8 <span class="sc">%in%</span></span>
<span id="cb15-473"><a href="#cb15-473" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb15-474"><a href="#cb15-474" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization after 24 hours"</span>,</span>
<span id="cb15-475"><a href="#cb15-475" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Hospitalization within 24 hours"</span>,</span>
<span id="cb15-476"><a href="#cb15-476" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Died within 24 hours"</span></span>
<span id="cb15-477"><a href="#cb15-477" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-478"><a href="#cb15-478" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-479"><a href="#cb15-479" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type_person), <span class="sc">!</span><span class="fu">is.na</span>(gender))</span>
<span id="cb15-480"><a href="#cb15-480" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-481"><a href="#cb15-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-482"><a href="#cb15-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-483"><a href="#cb15-483" aria-hidden="true" tabindex="-1"></a>The key points are:</span>
<span id="cb15-484"><a href="#cb15-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-485"><a href="#cb15-485" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Define raw data files with <span class="in">`tar_file()`</span></span>
<span id="cb15-486"><a href="#cb15-486" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Read raw data using functions like <span class="in">`readr::read_csv()`</span></span>
<span id="cb15-487"><a href="#cb15-487" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create cleaning functions that take raw data as arguments and return cleaned data</span>
<span id="cb15-488"><a href="#cb15-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-489"><a href="#cb15-489" aria-hidden="true" tabindex="-1"></a>You can also combine the first two steps by <span class="in">`tar_file_read()`</span>:</span>
<span id="cb15-490"><a href="#cb15-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-491"><a href="#cb15-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb15-492"><a href="#cb15-492" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb15-493"><a href="#cb15-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb15-494"><a href="#cb15-494" aria-hidden="true" tabindex="-1"></a>    data1_raw,</span>
<span id="cb15-495"><a href="#cb15-495" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here_rel</span>(<span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"file"</span>, <span class="st">"data1.csv"</span>),</span>
<span id="cb15-496"><a href="#cb15-496" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="sc">!!</span>.x),</span>
<span id="cb15-497"><a href="#cb15-497" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-498"><a href="#cb15-498" aria-hidden="true" tabindex="-1"></a>  <span class="at">data1_cleaned =</span> <span class="fu">clean_data1</span>(data1_raw)</span>
<span id="cb15-499"><a href="#cb15-499" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-500"><a href="#cb15-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-501"><a href="#cb15-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-502"><a href="#cb15-502" aria-hidden="true" tabindex="-1"></a>To download online files and define them with <span class="in">`tar_file`</span>:</span>
<span id="cb15-503"><a href="#cb15-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-504"><a href="#cb15-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb15-505"><a href="#cb15-505" aria-hidden="true" tabindex="-1"></a>download_file <span class="ot">&lt;-</span> <span class="cf">function</span>(url, destfile) {</span>
<span id="cb15-506"><a href="#cb15-506" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(destfile)) {</span>
<span id="cb15-507"><a href="#cb15-507" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(url, destfile)</span>
<span id="cb15-508"><a href="#cb15-508" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-509"><a href="#cb15-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(destfile)</span>
<span id="cb15-510"><a href="#cb15-510" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-511"><a href="#cb15-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-512"><a href="#cb15-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-513"><a href="#cb15-513" aria-hidden="true" tabindex="-1"></a>Define this function and call it within <span class="in">`tar_file()`</span>. The key is to return the path to the saved file.</span>
<span id="cb15-514"><a href="#cb15-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-515"><a href="#cb15-515" aria-hidden="true" tabindex="-1"></a>For your information, I have outlined my approach to data cleaning in this <span class="co">[</span><span class="ot">workshop</span><span class="co">](https://github.com/kazuyanagimoto/workshop-r-2022)</span>.</span>
<span id="cb15-516"><a href="#cb15-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-517"><a href="#cb15-517" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Configure the Website</span></span>
<span id="cb15-518"><a href="#cb15-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-519"><a href="#cb15-519" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`tar_quarto()`</span> to build a website within your pipeline. For the purpose of websites and specific configurations, see my blog post on <span class="co">[</span><span class="ot">"Researching as if to Blog"</span><span class="co">](https://kazuyanagimoto.com/blog/2024/04/05/)</span>.</span>
<span id="cb15-520"><a href="#cb15-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-521"><a href="#cb15-521" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Experiment with Data Analysis and Models</span></span>
<span id="cb15-522"><a href="#cb15-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-523"><a href="#cb15-523" aria-hidden="true" tabindex="-1"></a>Create notebook-style posts in the <span class="in">`playground`</span> directory of your website to experiment with data analysis and models.</span>
<span id="cb15-524"><a href="#cb15-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-525"><a href="#cb15-525" aria-hidden="true" tabindex="-1"></a>You can load cleaned data with <span class="in">`tar_load()`</span>. I define figure settings in <span class="in">`R/fns_graphics.R`</span> and import them when needed:</span>
<span id="cb15-526"><a href="#cb15-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-527"><a href="#cb15-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-528"><a href="#cb15-528" aria-hidden="true" tabindex="-1"></a><span class="in">````{.markdown filename="posts/240324_accident_bike/index.qmd"}</span></span>
<span id="cb15-529"><a href="#cb15-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-530"><a href="#cb15-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb15-531"><a href="#cb15-531" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb15-532"><a href="#cb15-532" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-533"><a href="#cb15-533" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-534"><a href="#cb15-534" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb15-535"><a href="#cb15-535" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytable)</span>
<span id="cb15-536"><a href="#cb15-536" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb15-537"><a href="#cb15-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-538"><a href="#cb15-538" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">tar_config_set</span>(</span>
<span id="cb15-539"><a href="#cb15-539" aria-hidden="true" tabindex="-1"></a>  <span class="at">store =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_targets"</span>),</span>
<span id="cb15-540"><a href="#cb15-540" aria-hidden="true" tabindex="-1"></a>  <span class="at">script =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_targets.R"</span>)</span>
<span id="cb15-541"><a href="#cb15-541" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-542"><a href="#cb15-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-543"><a href="#cb15-543" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">tar_load</span>(<span class="fu">c</span>(accident_bike))</span>
<span id="cb15-544"><a href="#cb15-544" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">list2env</span>(targets<span class="sc">::</span><span class="fu">tar_read</span>(fns_graphics), .GlobalEnv))</span>
<span id="cb15-545"><a href="#cb15-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-546"><a href="#cb15-546" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_proj</span>())</span>
<span id="cb15-547"><a href="#cb15-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-548"><a href="#cb15-548" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb15-549"><a href="#cb15-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-550"><a href="#cb15-550" aria-hidden="true" tabindex="-1"></a>The key is to avoid over-incorporating experiments into your pipeline. Most analyses in the experimental stage won't make it into the final paper. Including them in the pipeline makes dependency management unnecessarily complex. Instead, experiment in the <span class="in">`playground`</span> directory and only incorporate essential elements into the pipeline.</span>
<span id="cb15-551"><a href="#cb15-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-552"><a href="#cb15-552" aria-hidden="true" tabindex="-1"></a>By combining <span class="in">`tar_quarto()`</span> with Quarto's <span class="in">`freeze: auto`</span> setting, results are not recomputed unless you manually compile them. While this means that dependent parts won't recalculate when upstream changes occur, it has the benefit of minimal management for unnecessary parts. If upstream changes do occur, you can manually recompile only the necessary parts of the project.</span>
<span id="cb15-553"><a href="#cb15-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-554"><a href="#cb15-554" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. Summarize Interim Results in Slides</span></span>
<span id="cb15-555"><a href="#cb15-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-556"><a href="#cb15-556" aria-hidden="true" tabindex="-1"></a>During research, you'll often present interim results. It's good practice to compile important findings from your experiments into slides. Like the experimental phase, this doesn't need to be incorporated into the pipeline. In this project, the <span class="in">`slide`</span> directory is compiled as part of the website.</span>
<span id="cb15-557"><a href="#cb15-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-558"><a href="#cb15-558" aria-hidden="true" tabindex="-1"></a>I create slides using <span class="co">[</span><span class="ot">Quarto Clean Theme</span><span class="co">](https://github.com/kazuyanagimoto/quarto-clean-typst)</span>. Since they're created with Quarto, they integrate naturally into this workflow. Additionally, using Typst allows for faster compilation than Beamer. You can see the <span class="co">[</span><span class="ot">demo</span><span class="co">](https://kazuyanagimoto.com/quarto-clean-typst/template-full.pdf)</span> for details.</span>
<span id="cb15-559"><a href="#cb15-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-560"><a href="#cb15-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-561"><a href="#cb15-561" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6. Repeat Steps 3-5 and Incorporate Key Results into the Pipeline</span></span>
<span id="cb15-562"><a href="#cb15-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-563"><a href="#cb15-563" aria-hidden="true" tabindex="-1"></a>Continue your research, getting feedback from presentations. When you have sufficient results for your manuscript, proceed to the next step. This is where you define pipelines in files like <span class="in">`R/tar_fact.R`</span> and <span class="in">`R/tar_model.R`</span>.</span>
<span id="cb15-564"><a href="#cb15-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-565"><a href="#cb15-565" aria-hidden="true" tabindex="-1"></a><span class="fu">### Incorporate Key Results into the Pipeline</span></span>
<span id="cb15-566"><a href="#cb15-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-567"><a href="#cb15-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="R/tar_fact.R"}</span></span>
<span id="cb15-568"><a href="#cb15-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-569"><a href="#cb15-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar_fact</span></span>
<span id="cb15-570"><a href="#cb15-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb15-571"><a href="#cb15-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: R/tar_fact.R</span></span>
<span id="cb15-572"><a href="#cb15-572" aria-hidden="true" tabindex="-1"></a>fact <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb15-573"><a href="#cb15-573" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_accident =</span> <span class="fu">compute_num_accident</span>(accident_bike),</span>
<span id="cb15-574"><a href="#cb15-574" aria-hidden="true" tabindex="-1"></a>  <span class="at">logit_hospital_death =</span> <span class="fu">compute_logit_hospital_death</span>(accident_bike)</span>
<span id="cb15-575"><a href="#cb15-575" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-576"><a href="#cb15-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-577"><a href="#cb15-577" aria-hidden="true" tabindex="-1"></a>compute_num_accident <span class="ot">&lt;-</span> <span class="cf">function</span>(accident_bike) {</span>
<span id="cb15-578"><a href="#cb15-578" aria-hidden="true" tabindex="-1"></a>  accident_bike <span class="sc">|&gt;</span></span>
<span id="cb15-579"><a href="#cb15-579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(type_person, gender))</span>
<span id="cb15-580"><a href="#cb15-580" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-581"><a href="#cb15-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-582"><a href="#cb15-582" aria-hidden="true" tabindex="-1"></a>compute_logit_hospital_death <span class="ot">&lt;-</span> <span class="cf">function</span>(accident_bike) {</span>
<span id="cb15-583"><a href="#cb15-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb15-584"><a href="#cb15-584" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(1)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb15-585"><a href="#cb15-585" aria-hidden="true" tabindex="-1"></a>      is_hospitalized <span class="sc">~</span></span>
<span id="cb15-586"><a href="#cb15-586" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span> positive_alcohol <span class="sc">+</span> positive_drug <span class="sc">|</span> age_c <span class="sc">+</span> gender,</span>
<span id="cb15-587"><a href="#cb15-587" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb15-588"><a href="#cb15-588" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb15-589"><a href="#cb15-589" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-590"><a href="#cb15-590" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(2)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb15-591"><a href="#cb15-591" aria-hidden="true" tabindex="-1"></a>      is_hospitalized <span class="sc">~</span></span>
<span id="cb15-592"><a href="#cb15-592" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb15-593"><a href="#cb15-593" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb15-594"><a href="#cb15-594" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb15-595"><a href="#cb15-595" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle,</span>
<span id="cb15-596"><a href="#cb15-596" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb15-597"><a href="#cb15-597" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb15-598"><a href="#cb15-598" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-599"><a href="#cb15-599" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(3)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb15-600"><a href="#cb15-600" aria-hidden="true" tabindex="-1"></a>      is_hospitalized <span class="sc">~</span></span>
<span id="cb15-601"><a href="#cb15-601" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb15-602"><a href="#cb15-602" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb15-603"><a href="#cb15-603" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb15-604"><a href="#cb15-604" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle <span class="sc">+</span> weather,</span>
<span id="cb15-605"><a href="#cb15-605" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb15-606"><a href="#cb15-606" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb15-607"><a href="#cb15-607" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-608"><a href="#cb15-608" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(4)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb15-609"><a href="#cb15-609" aria-hidden="true" tabindex="-1"></a>      is_died <span class="sc">~</span> type_person <span class="sc">+</span> positive_alcohol <span class="sc">+</span> positive_drug <span class="sc">|</span> age_c <span class="sc">+</span> gender,</span>
<span id="cb15-610"><a href="#cb15-610" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb15-611"><a href="#cb15-611" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb15-612"><a href="#cb15-612" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-613"><a href="#cb15-613" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(5)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb15-614"><a href="#cb15-614" aria-hidden="true" tabindex="-1"></a>      is_died <span class="sc">~</span></span>
<span id="cb15-615"><a href="#cb15-615" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb15-616"><a href="#cb15-616" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb15-617"><a href="#cb15-617" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb15-618"><a href="#cb15-618" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle,</span>
<span id="cb15-619"><a href="#cb15-619" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb15-620"><a href="#cb15-620" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb15-621"><a href="#cb15-621" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-622"><a href="#cb15-622" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(6)"</span> <span class="ot">=</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(</span>
<span id="cb15-623"><a href="#cb15-623" aria-hidden="true" tabindex="-1"></a>      is_died <span class="sc">~</span></span>
<span id="cb15-624"><a href="#cb15-624" aria-hidden="true" tabindex="-1"></a>        type_person <span class="sc">+</span></span>
<span id="cb15-625"><a href="#cb15-625" aria-hidden="true" tabindex="-1"></a>          positive_alcohol <span class="sc">+</span></span>
<span id="cb15-626"><a href="#cb15-626" aria-hidden="true" tabindex="-1"></a>          positive_drug <span class="sc">|</span></span>
<span id="cb15-627"><a href="#cb15-627" aria-hidden="true" tabindex="-1"></a>          age_c <span class="sc">+</span> gender <span class="sc">+</span> type_vehicle <span class="sc">+</span> weather,</span>
<span id="cb15-628"><a href="#cb15-628" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(logit),</span>
<span id="cb15-629"><a href="#cb15-629" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> accident_bike</span>
<span id="cb15-630"><a href="#cb15-630" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-631"><a href="#cb15-631" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-632"><a href="#cb15-632" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-633"><a href="#cb15-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-634"><a href="#cb15-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-635"><a href="#cb15-635" aria-hidden="true" tabindex="-1"></a>Incorporate figures needed for your paper into the pipeline. I define functions like <span class="in">`compute_*()`</span> that take cleaned data as arguments and return calculated results as numbers or data frames. I don't create figures here—I do that within the manuscript.</span>
<span id="cb15-636"><a href="#cb15-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-637"><a href="#cb15-637" aria-hidden="true" tabindex="-1"></a>For LaTeX users, you might want to save figures at this stage. For example:</span>
<span id="cb15-638"><a href="#cb15-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-639"><a href="#cb15-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb15-640"><a href="#cb15-640" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb15-641"><a href="#cb15-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file</span>(</span>
<span id="cb15-642"><a href="#cb15-642" aria-hidden="true" tabindex="-1"></a>    fig1_file,</span>
<span id="cb15-643"><a href="#cb15-643" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_fig1</span>(data1, <span class="fu">here_rel</span>(<span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"file"</span>, <span class="st">"fig1.pdf"</span>))</span>
<span id="cb15-644"><a href="#cb15-644" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-645"><a href="#cb15-645" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-646"><a href="#cb15-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-647"><a href="#cb15-647" aria-hidden="true" tabindex="-1"></a>plot_fig1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data1, path_fig1) {</span>
<span id="cb15-648"><a href="#cb15-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data1, <span class="fu">aes</span>(<span class="at">x =</span> col1, <span class="at">y =</span> col2)) <span class="sc">+</span></span>
<span id="cb15-649"><a href="#cb15-649" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb15-650"><a href="#cb15-650" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-651"><a href="#cb15-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(path_fig1)</span>
<span id="cb15-652"><a href="#cb15-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(path_fig1)</span>
<span id="cb15-653"><a href="#cb15-653" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-654"><a href="#cb15-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-655"><a href="#cb15-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-656"><a href="#cb15-656" aria-hidden="true" tabindex="-1"></a><span class="fu">### Incorporate Julia Code into the Pipeline</span></span>
<span id="cb15-657"><a href="#cb15-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-658"><a href="#cb15-658" aria-hidden="true" tabindex="-1"></a>While R analyses can be directly incorporated into the pipeline, Julia code requires some extra steps. Here's my approach:</span>
<span id="cb15-659"><a href="#cb15-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-660"><a href="#cb15-660" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Load Julia source code files with <span class="in">`tar_file_read()`</span> and incorporate them as <span class="in">`jl_file_*`</span></span>
<span id="cb15-661"><a href="#cb15-661" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Execute Julia code from R using <span class="in">`system2()`</span> via the <span class="in">`run_model()`</span> function</span>
<span id="cb15-662"><a href="#cb15-662" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Save Julia execution results as CSV or YAML files for loading in R with <span class="in">`tar_file_read()`</span></span>
<span id="cb15-663"><a href="#cb15-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-664"><a href="#cb15-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="R/tar_model.R"}</span></span>
<span id="cb15-665"><a href="#cb15-665" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-666"><a href="#cb15-666" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar_model</span></span>
<span id="cb15-667"><a href="#cb15-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb15-668"><a href="#cb15-668" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: R/tar_model.R</span></span>
<span id="cb15-669"><a href="#cb15-669" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">tar_plan</span>(</span>
<span id="cb15-670"><a href="#cb15-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_map</span>(</span>
<span id="cb15-671"><a href="#cb15-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"main"</span>, <span class="st">"model"</span>)),</span>
<span id="cb15-672"><a href="#cb15-672" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> name,</span>
<span id="cb15-673"><a href="#cb15-673" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar_file_read</span>(</span>
<span id="cb15-674"><a href="#cb15-674" aria-hidden="true" tabindex="-1"></a>      jl,</span>
<span id="cb15-675"><a href="#cb15-675" aria-hidden="true" tabindex="-1"></a>      <span class="fu">here_rel</span>(<span class="st">"Julia"</span>, <span class="fu">paste0</span>(name, <span class="st">".jl"</span>)),</span>
<span id="cb15-676"><a href="#cb15-676" aria-hidden="true" tabindex="-1"></a>      <span class="fu">readLines</span>(<span class="sc">!!</span>.x)</span>
<span id="cb15-677"><a href="#cb15-677" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-678"><a href="#cb15-678" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-679"><a href="#cb15-679" aria-hidden="true" tabindex="-1"></a>  <span class="at">res_model =</span> <span class="fu">run_model</span>(jl_file_main, jl_main, jl_model),</span>
<span id="cb15-680"><a href="#cb15-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb15-681"><a href="#cb15-681" aria-hidden="true" tabindex="-1"></a>    parameters,</span>
<span id="cb15-682"><a href="#cb15-682" aria-hidden="true" tabindex="-1"></a>    res_model[[<span class="dv">1</span>]],</span>
<span id="cb15-683"><a href="#cb15-683" aria-hidden="true" tabindex="-1"></a>    yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="sc">!!</span>.x)</span>
<span id="cb15-684"><a href="#cb15-684" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-685"><a href="#cb15-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb15-686"><a href="#cb15-686" aria-hidden="true" tabindex="-1"></a>    demand_supply,</span>
<span id="cb15-687"><a href="#cb15-687" aria-hidden="true" tabindex="-1"></a>    res_model[[<span class="dv">2</span>]],</span>
<span id="cb15-688"><a href="#cb15-688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read.csv</span>(<span class="sc">!!</span>.x)</span>
<span id="cb15-689"><a href="#cb15-689" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-690"><a href="#cb15-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb15-691"><a href="#cb15-691" aria-hidden="true" tabindex="-1"></a>    equilibrium,</span>
<span id="cb15-692"><a href="#cb15-692" aria-hidden="true" tabindex="-1"></a>    res_model[[<span class="dv">3</span>]],</span>
<span id="cb15-693"><a href="#cb15-693" aria-hidden="true" tabindex="-1"></a>    yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="sc">!!</span>.x)</span>
<span id="cb15-694"><a href="#cb15-694" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-695"><a href="#cb15-695" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-696"><a href="#cb15-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-697"><a href="#cb15-697" aria-hidden="true" tabindex="-1"></a>run_model <span class="ot">&lt;-</span> <span class="cf">function</span>(jl_file_main, ...) {</span>
<span id="cb15-698"><a href="#cb15-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system2</span>(<span class="at">command =</span> <span class="st">"julia"</span>, <span class="at">args =</span> <span class="fu">c</span>(<span class="st">"--project=."</span>, jl_file_main))</span>
<span id="cb15-699"><a href="#cb15-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-700"><a href="#cb15-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">file.path</span>(</span>
<span id="cb15-701"><a href="#cb15-701" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here_rel</span>(<span class="st">"output"</span>, <span class="st">"Julia"</span>),</span>
<span id="cb15-702"><a href="#cb15-702" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"parameters.yaml"</span>, <span class="st">"demand_supply.csv"</span>, <span class="st">"equilibrium.yaml"</span>)</span>
<span id="cb15-703"><a href="#cb15-703" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb15-704"><a href="#cb15-704" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-705"><a href="#cb15-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-706"><a href="#cb15-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-707"><a href="#cb15-707" aria-hidden="true" tabindex="-1"></a>The key points are:</span>
<span id="cb15-708"><a href="#cb15-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-709"><a href="#cb15-709" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Specify all dependencies in <span class="in">`run_model()`</span> arguments to include Julia dependencies</span>
<span id="cb15-710"><a href="#cb15-710" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Group saved result files into a list and load them one by one from R</span>
<span id="cb15-711"><a href="#cb15-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-712"><a href="#cb15-712" aria-hidden="true" tabindex="-1"></a>When executing with <span class="in">`system2()`</span>, Julia's path might not be accessible (due to differences between your PC's default shell and R's shell). In that case, define Julia's path in <span class="in">`.Renviron`</span>:</span>
<span id="cb15-713"><a href="#cb15-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-714"><a href="#cb15-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{.bash filename=".Renviron"}</span></span>
<span id="cb15-715"><a href="#cb15-715" aria-hidden="true" tabindex="-1"></a><span class="va">PATH_JULIA</span><span class="op">=</span>/path/to/julia/</span>
<span id="cb15-716"><a href="#cb15-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-717"><a href="#cb15-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-718"><a href="#cb15-718" aria-hidden="true" tabindex="-1"></a>And load it in <span class="in">`.Rprofile`</span>:</span>
<span id="cb15-719"><a href="#cb15-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-720"><a href="#cb15-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r filename=".Rprofile"}</span></span>
<span id="cb15-721"><a href="#cb15-721" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"renv/activate.R"</span>)</span>
<span id="cb15-722"><a href="#cb15-722" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(</span>
<span id="cb15-723"><a href="#cb15-723" aria-hidden="true" tabindex="-1"></a>  <span class="at">PATH =</span> <span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">"PATH_JULIA"</span>), <span class="fu">Sys.getenv</span>(<span class="st">"PATH"</span>), <span class="at">sep =</span> <span class="st">":"</span>)</span>
<span id="cb15-724"><a href="#cb15-724" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-725"><a href="#cb15-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-726"><a href="#cb15-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-727"><a href="#cb15-727" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. Write the Manuscript with Final Results</span></span>
<span id="cb15-728"><a href="#cb15-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-729"><a href="#cb15-729" aria-hidden="true" tabindex="-1"></a>Write your manuscript in the <span class="in">`manuscript`</span> directory. Here, load the pipeline execution results with <span class="in">`tar_load()`</span>. I use these three steps:</span>
<span id="cb15-730"><a href="#cb15-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-731"><a href="#cb15-731" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Configure the directory as a <span class="co">[</span><span class="ot">Quarto Book</span><span class="co">](https://quarto.org/docs/books/)</span> in <span class="in">`manuscript/_quarto.yml`</span></span>
<span id="cb15-732"><a href="#cb15-732" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Write the Quarto Book as <span class="in">`01-intro.qmd`</span>, etc.</span>
<span id="cb15-733"><a href="#cb15-733" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Combine <span class="in">`01-intro.qmd`</span>, <span class="in">`02-methods.qmd`</span>, etc. in <span class="in">`manuscript/main.qmd`</span> (using <span class="in">`{{&lt; include **-**.qmd &gt;}}`</span>) and compile</span>
<span id="cb15-734"><a href="#cb15-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-735"><a href="#cb15-735" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Write as a Quarto Book?</span></span>
<span id="cb15-736"><a href="#cb15-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-737"><a href="#cb15-737" aria-hidden="true" tabindex="-1"></a>Writing as a Quarto Book enables cross-references across multiple files. This is very convenient—dividing your manuscript into files by section makes the structure easier to grasp, and cross-reference auto-completion makes writing smoother.</span>
<span id="cb15-738"><a href="#cb15-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-739"><a href="#cb15-739" aria-hidden="true" tabindex="-1"></a>However, the Quarto Book output format isn't ideal for papers, so I combine these files and compile them in <span class="in">`manuscript/main.qmd`</span>:</span>
<span id="cb15-740"><a href="#cb15-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-741"><a href="#cb15-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{.md filename="manuscript/main.qmd"}</span></span>
<span id="cb15-742"><a href="#cb15-742" aria-hidden="true" tabindex="-1"></a>{{{&lt; include 01-intro.qmd &gt;}}}</span>
<span id="cb15-743"><a href="#cb15-743" aria-hidden="true" tabindex="-1"></a>{{{&lt; include 02-fact.qmd &gt;}}}</span>
<span id="cb15-744"><a href="#cb15-744" aria-hidden="true" tabindex="-1"></a>{{{&lt; include 03-model.qmd &gt;}}}</span>
<span id="cb15-745"><a href="#cb15-745" aria-hidden="true" tabindex="-1"></a>{{{&lt; include 04-result.qmd &gt;}}}</span>
<span id="cb15-746"><a href="#cb15-746" aria-hidden="true" tabindex="-1"></a>{{{&lt; include 05-conclusion.qmd &gt;}}}</span>
<span id="cb15-747"><a href="#cb15-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-748"><a href="#cb15-748" aria-hidden="true" tabindex="-1"></a>{{{&lt; appendix &gt;}}}</span>
<span id="cb15-749"><a href="#cb15-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-750"><a href="#cb15-750" aria-hidden="true" tabindex="-1"></a>{{{&lt; include 11-data.qmd &gt;}}}</span>
<span id="cb15-751"><a href="#cb15-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-752"><a href="#cb15-752" aria-hidden="true" tabindex="-1"></a>{{{&lt; pagebreak &gt;}}}</span>
<span id="cb15-753"><a href="#cb15-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-754"><a href="#cb15-754" aria-hidden="true" tabindex="-1"></a>:::{#refs}</span>
<span id="cb15-755"><a href="#cb15-755" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-756"><a href="#cb15-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-757"><a href="#cb15-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-758"><a href="#cb15-758" aria-hidden="true" tabindex="-1"></a>I use Typst as the backend for fast compilation and the <span class="co">[</span><span class="ot">quarto-academic-typst</span><span class="co">](https://github.com/kazuyanagimoto/quarto-academic-typst)</span> template. If you need LaTeX source code, you can generate it with <span class="in">`quarto::quarto_render()`</span> (I used this for my doctoral thesis to match the LaTeX template).</span>
<span id="cb15-759"><a href="#cb15-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-760"><a href="#cb15-760" aria-hidden="true" tabindex="-1"></a><span class="fu">### For LaTeX Users</span></span>
<span id="cb15-761"><a href="#cb15-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-762"><a href="#cb15-762" aria-hidden="true" tabindex="-1"></a>If you're writing in LaTeX and compiling with <span class="in">`TinyTeX`</span>, you can incorporate it into the pipeline. For example:</span>
<span id="cb15-763"><a href="#cb15-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-764"><a href="#cb15-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb15-765"><a href="#cb15-765" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_plan</span>(</span>
<span id="cb15-766"><a href="#cb15-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file_read</span>(</span>
<span id="cb15-767"><a href="#cb15-767" aria-hidden="true" tabindex="-1"></a>    manuscript,</span>
<span id="cb15-768"><a href="#cb15-768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here_rel</span>(<span class="st">"manuscript"</span>, <span class="st">"main.tex"</span>),</span>
<span id="cb15-769"><a href="#cb15-769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">readLines</span>(<span class="sc">!!</span>.x)</span>
<span id="cb15-770"><a href="#cb15-770" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-771"><a href="#cb15-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_file</span>(</span>
<span id="cb15-772"><a href="#cb15-772" aria-hidden="true" tabindex="-1"></a>    manuscript_pdf,</span>
<span id="cb15-773"><a href="#cb15-773" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compile_latex</span>(manuscript, <span class="fu">here_rel</span>(<span class="st">"manuscript"</span>, <span class="st">"main.pdf"</span>))</span>
<span id="cb15-774"><a href="#cb15-774" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-775"><a href="#cb15-775" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-776"><a href="#cb15-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-777"><a href="#cb15-777" aria-hidden="true" tabindex="-1"></a>compile_latex <span class="ot">&lt;-</span> <span class="cf">function</span>(manuscript_file, path_pdf) {</span>
<span id="cb15-778"><a href="#cb15-778" aria-hidden="true" tabindex="-1"></a>  tinytex<span class="sc">::</span><span class="fu">xelatex</span>(</span>
<span id="cb15-779"><a href="#cb15-779" aria-hidden="true" tabindex="-1"></a>    manuscript_file,</span>
<span id="cb15-780"><a href="#cb15-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> path_pdf</span>
<span id="cb15-781"><a href="#cb15-781" aria-hidden="true" tabindex="-1"></a>    <span class="at">pdf_file =</span> path_pdf</span>
<span id="cb15-782"><a href="#cb15-782" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-783"><a href="#cb15-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(path_pdf)</span>
<span id="cb15-784"><a href="#cb15-784" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-785"><a href="#cb15-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-786"><a href="#cb15-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-787"><a href="#cb15-787" aria-hidden="true" tabindex="-1"></a>Note that you may need to include all figure and table dependencies.</span>
<span id="cb15-788"><a href="#cb15-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-789"><a href="#cb15-789" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb15-790"><a href="#cb15-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-791"><a href="#cb15-791" aria-hidden="true" tabindex="-1"></a>I've explained a research workflow using Quarto + <span class="in">`{targets}`</span>. While <span class="in">`{targets}`</span> might be somewhat challenging at first, trusting in it and maintaining an executable state will help you maintain reproducibility. Ultimately, this should help you conduct your research more efficiently.</span>
<span id="cb15-792"><a href="#cb15-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-793"><a href="#cb15-793" aria-hidden="true" tabindex="-1"></a>Happy Quarto + {targets} Life! 🥂</span>
<span id="cb15-794"><a href="#cb15-794" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-solid fa-copyright" aria-label="copyright"></i> 2021 Kazuharu Yanagimoto</span> <span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0009-0007-1967-8304">0009-0007-1967-8304</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><a href="https://github.com/kazuyanagimoto"><i class="fa-brands fa-github" aria-label="github"></i></a> <a href="https://twitter.com/kazuyanagimoto"><i class="fa-brands fa-x-twitter" aria-label="x-twitter"></i></a> <a href="https://bsky.app/profile/kazuyanagimoto.com"><iconify-icon inline="" icon="simple-icons:bluesky"></iconify-icon></a> <a href="https://www.linkedin.com/in/kazuharu-yanagimoto/"><i class="fa-brands fa-linkedin" aria-label="linkedin"></i></a> <a href="https://zenn.dev/nicetak"><iconify-icon inline="" icon="simple-icons:zenn"></iconify-icon></a></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block">View the source at <a href="https://github.com/kazuyanagimoto/kazuyanagimoto.github.io"><i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>




</body></html>